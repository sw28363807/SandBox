!function(){"use strict";class e{}e.SoundPiano1Path="source/sound/1.mp3",e.SoundPiano2Path="source/sound/2.mp3",e.SoundPiano3Path="source/sound/3.mp3",e.SoundPiano4Path="source/sound/4.mp3",e.SoundPiano5Path="source/sound/5.mp3",e.SoundPiano6Path="source/sound/6.mp3",e.SoundPiano7Path="source/sound/7.mp3",e.ManAniPath="anim/Man.ani",e.WomanAniPath="anim/Woman.ani",e.SchoolDialogScenePath="scene/SchoolDialog.scene",e.ChildSchoolDialogScenePath="scene/ChildSchoolDialog.scene",e.HospitalDialogScenePath="scene/HospitalDialog.scene",e.OperaDialogScenePath="scene/OperaDialog.scene",e.FarmLandDialogScenePath="scene/FarmLandDialog.scene",e.PastureDialogScenePath="scene/PastureDialog.scene",e.LabDialogScenePath="scene/LabDialog.scene",e.OfficeDialogScenePath="scene/OfficeDialog.scene",e.ResidentPrefabPath="prefab/Resident.prefab",e.FoodPrefabPath="prefab/Food.prefab",e.ResdientDetailsPanelPath="prefab/ResidentDetailsPanel.prefab",e.AnimalPrefabPath="prefab/Animal.prefab",e.PetPrefabPath="prefab/Pet.prefab",e.Livestock1PrefabPath="prefab/Livestock1.prefab",e.Livestock2PrefabPath="prefab/Livestock2.prefab",e.Livestock3PrefabPath="prefab/Livestock3.prefab",e.DragRenderPrefabPath="prefab/DragRender.prefab",e.TipPrefabPath="prefab/Tip.prefab",e.CommonItemPrefabPath="prefab/CommonItem.prefab",e.BuildingAtlasPath="res/atlas/source/building.atlas",e.ResidentAtlasPath="res/atlas/source/resident.atlas",e.HomePrefabPath="prefab/Home.prefab",e.HospitalPrefabPath="prefab/Hospital.prefab",e.SchoolPrefabPath="prefab/School.prefab",e.ChildSchoolPrefabPath="prefab/ChildSchool.prefab",e.FarmLandPrefabPath="prefab/FarmLand.prefab",e.PasturePrefabPath="prefab/Pasture.prefab",e.OperaPrefabPath="prefab/Opera.prefab",e.OfficePrefabPath="prefab/Office.prefab",e.LabPrefabPath="prefab/Lab.prefab",e.FoodPoolPrefabPath="prefab/FoodPool.prefab",e.WaterPoolPrefabPath="prefab/WaterPool.prefab",e.FirePrefabPath="prefab/Fire.prefab",e.SpeedBuildingPrefabPath="prefab/SpeedBuilding.prefab",e.ToolBuildingPrefabPath="prefab/ToolBuilding.prefab",e.VillageComPrefabPath="prefab/VillageCom.prefab",e.BloodBuildingPrefabPath="prefab/BloodBuilding.prefab",e.ResourceMap=[{type:Laya.Loader.SOUND,url:e.SoundPiano1Path},{type:Laya.Loader.SOUND,url:e.SoundPiano2Path},{type:Laya.Loader.SOUND,url:e.SoundPiano3Path},{type:Laya.Loader.SOUND,url:e.SoundPiano4Path},{type:Laya.Loader.SOUND,url:e.SoundPiano5Path},{type:Laya.Loader.SOUND,url:e.SoundPiano6Path},{type:Laya.Loader.SOUND,url:e.SoundPiano7Path},{type:Laya.Loader.ATLAS,url:e.BuildingAtlasPath},{type:Laya.Loader.ATLAS,url:e.ResidentAtlasPath},{type:Laya.Loader.PREFAB,url:e.ResidentPrefabPath},{type:Laya.Loader.PREFAB,url:e.FoodPrefabPath},{type:Laya.Loader.PREFAB,url:e.ResdientDetailsPanelPath},{type:Laya.Loader.PREFAB,url:e.DragRenderPrefabPath},{type:Laya.Loader.PREFAB,url:e.TipPrefabPath},{type:Laya.Loader.PREFAB,url:e.CommonItemPrefabPath},{type:Laya.Loader.PREFAB,url:e.AnimalPrefabPath},{type:Laya.Loader.PREFAB,url:e.PetPrefabPath},{type:Laya.Loader.PREFAB,url:e.Livestock1PrefabPath},{type:Laya.Loader.PREFAB,url:e.Livestock2PrefabPath},{type:Laya.Loader.PREFAB,url:e.Livestock3PrefabPath},{type:Laya.Loader.PREFAB,url:e.HomePrefabPath},{type:Laya.Loader.PREFAB,url:e.HospitalPrefabPath},{type:Laya.Loader.PREFAB,url:e.HospitalPrefabPath},{type:Laya.Loader.PREFAB,url:e.SchoolPrefabPath},{type:Laya.Loader.PREFAB,url:e.ChildSchoolPrefabPath},{type:Laya.Loader.PREFAB,url:e.FarmLandPrefabPath},{type:Laya.Loader.PREFAB,url:e.PasturePrefabPath},{type:Laya.Loader.PREFAB,url:e.OperaPrefabPath},{type:Laya.Loader.PREFAB,url:e.OfficePrefabPath},{type:Laya.Loader.PREFAB,url:e.LabPrefabPath},{type:Laya.Loader.PREFAB,url:e.FoodPoolPrefabPath},{type:Laya.Loader.PREFAB,url:e.WaterPoolPrefabPath},{type:Laya.Loader.PREFAB,url:e.FirePrefabPath},{type:Laya.Loader.PREFAB,url:e.SpeedBuildingPrefabPath},{type:Laya.Loader.PREFAB,url:e.ToolBuildingPrefabPath},{type:Laya.Loader.PREFAB,url:e.VillageComPrefabPath},{type:Laya.Loader.PREFAB,url:e.BloodBuildingPrefabPath}];class t extends Laya.Script{constructor(){super(),this.loadIndex=0,this.prefabs={}}static getInstance(){return t.instance=t.instance||new t}loadAllRes(e){this.loadIndex=0,this._loadRes(e)}_loadRes(t){if(this.loadIndex>=e.ResourceMap.length&&t)return void t.run();let i=e.ResourceMap[this.loadIndex];Laya.loader.create(i.url,Laya.Handler.create(this,function(e){i.type==Laya.Loader.PREFAB&&(this.prefabs[i.url]=e),this.loadIndex++,this._loadRes(t)}))}getPrefabInfo(e){return this.prefabs[e]}}class i extends Laya.Script{constructor(){super()}onEnable(){let e=this.owner.getChildByName("image");this.textLabel=e.getChildByName("label"),e.x=-e.width/2}onDisable(){}setString(e){this.textLabel.text=e,this.owner.zOrder=65535,this.owner.x=Laya.stage.width/2,this.owner.y=Laya.stage.height/2,Laya.Tween.to(this.owner,{y:this.owner.y-70},300,Laya.Ease.linearOut,Laya.Handler.create(this,function(){Laya.timer.once(1e3,this,function(){Laya.Tween.to(this.owner,{alpha:0},500,Laya.Ease.linearOut,Laya.Handler.create(this,function(){this.owner.destroy(!0)}))})}))}}class n extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}static getInstance(){return n.instance=n.instance||new n}showTip(t,n){let s=Laya.loader.getRes(e.TipPrefabPath).create();Laya.stage.addChild(s),s.getComponent(i).setString(t)}}class s{static obtainBuildingType(){for(const e in s.BuildingType)s.BuildingType[e]=e}static obtainBuildingState(){for(const e in s.BuildingState)s.BuildingState[e]=e}}s.BuildingType={NullTyupe:"",HomeType:"",HospitalType:"",SchoolType:"",FarmLandType:"",PastureType:"",OperaType:"",LabType:"",OfficeType:"",ChildSchoolType:"",FoodPoolType:"",WaterPoolType:"",FireType:"",SpeedBuildingType:"",ToolBuildingType:"",VilllageComType:"",BloodBuildingType:""},s.obtainBuildingType(),s.BuildingState={NullState:"",PreCreating:"",Creating:"",Noraml:"",Occupy:""},s.obtainBuildingState(),s.BuildingCreatingStep=100,s.HomeResidentMaxNum=3,s.BuildingDatas={[String(s.BuildingType.HomeType)]:{prefab:e.HomePrefabPath,preview:"",realWidth:350,realHeight:350,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"家",costTree:0,costStone:0,desc:"居住的地方"},[String(s.BuildingType.HospitalType)]:{prefab:e.HospitalPrefabPath,preview:"source/building/hospital1_1.png",realWidth:400,realHeight:400,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"医院",costTree:0,costStone:0,desc:"可以治疗疾病",doctors:[{doctorId:1,name:"王二狗大夫",desc:"医术一般般",healProbability:50,sex:1,costGold:1},{doctorId:2,name:"赵德柱大夫",desc:"医术还可以",healProbability:90,sex:2,costGold:2}]},[String(s.BuildingType.WaterPoolType)]:{prefab:e.WaterPoolPrefabPath,preview:"source/building/WaterPool.png",realWidth:300,realHeight:300,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"水仓库",costTree:1,costStone:1,maxSave:1e3,desc:"可以保存水源以便今后使用"},[String(s.BuildingType.FoodPoolType)]:{prefab:e.FoodPoolPrefabPath,preview:"source/building/FoodPool.png",realWidth:300,realHeight:300,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"食物仓库",costTree:2,costStone:2,maxSave:600,desc:"可以保存食物以便今后使用"},[String(s.BuildingType.OfficeType)]:{prefab:e.OfficePrefabPath,preview:"source/building/office.png",realWidth:400,realHeight:400,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"写字楼",costTree:3,costStone:3,addGold:1,maxSave:10,desc:"居民收入来源"},[String(s.BuildingType.ChildSchoolType)]:{prefab:e.ChildSchoolPrefabPath,preview:"source/building/child_school.png",realWidth:350,realHeight:350,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"幼儿园",costTree:4,costStone:4,desc:"可以让孩子快速成长",teachers:[{teacherId:1,name:"大嘚嘞老师",desc:"教学很一般",sex:1,costGold:0,addAgePriority:.5},{teacherId:2,name:"北辰沈老师",desc:"教学一般般，人很漂亮，但是对于提升教育质量似乎没有什么用",sex:2,costGold:0,addAgePriority:.3},{teacherId:3,name:"李翠萍老师",desc:"教学还可以",sex:1,costGold:0,addAgePriority:.1}]},[String(s.BuildingType.PastureType)]:{prefab:e.PasturePrefabPath,preview:"source/building/pasture_big.png",realWidth:500,realHeight:300,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"牧场",costTree:5,costStone:5,maxSave:3e3,addFood:100,gameAddFood:10,desc:"可以养殖动物，春天冬天可以收获哦~"},[String(s.BuildingType.SchoolType)]:{prefab:e.SchoolPrefabPath,preview:"source/building/school_1.png",realWidth:300,realHeight:300,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"学校",costTree:6,costStone:6,desc:"可以增长教育，促进科技发展",teachers:[{teacherId:1,name:"李翠萍老师",desc:"教学一般般",addTeach:10,addTeachPriority:.5,sex:1,costGold:0},{teacherId:2,name:"北辰沈老师",desc:"教学一般般，人很漂亮，但是对于提升教育质量似乎没有什么用",addTeach:15,addTeachPriority:.2,sex:2,costGold:0},{teacherId:3,name:"大嘚嘞老师",desc:"教学一般般，人很漂亮，但是对于提升教育质量似乎也没有什么用",addTeach:17,addTeachPriority:.1,sex:2,costGold:0}]},[String(s.BuildingType.FarmLandType)]:{prefab:e.FarmLandPrefabPath,preview:"source/building/farmland.png",realWidth:400,realHeight:300,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"农田",costTree:1,costStone:1,maxSave:3e3,addFood:100,gameAddFood:10,desc:"可以种植增加食物，夏天秋天可以收获哦~"},[String(s.BuildingType.LabType)]:{prefab:e.LabPrefabPath,preview:"source/building/scienceLab.png",realWidth:500,realHeight:500,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"科学实验室",costTree:30,costStone:30,desc:"快速增长科技研究"},[String(s.BuildingType.OperaType)]:{prefab:e.OperaPrefabPath,preview:"source/building/center2.png",realWidth:400,realHeight:400,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"歌剧院",costTree:1,costStone:2,addTouchEnjoy:1,desc:"可以让居民快乐的地方"},[String(s.BuildingType.FireType)]:{prefab:e.FirePrefabPath,preview:"",realWidth:200,realHeight:200,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"",costTree:0,costStone:0,heatingMaxTImes:10,desc:""},[String(s.BuildingType.SpeedBuildingType)]:{prefab:e.SpeedBuildingPrefabPath,preview:"source/building/speedBuilding.png",realWidth:250,realHeight:250,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"健身房",costTree:2,costStone:3,addSpeedScale:1.5,desc:"可以健身增加居民移动速度"},[String(s.BuildingType.ToolBuildingType)]:{prefab:e.ToolBuildingPrefabPath,preview:"source/building/ToolBuilding.png",realWidth:250,realHeight:250,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"工具工坊",costTree:3,costStone:3,desc:"可以升级工具加快资源收集速度"},[String(s.BuildingType.VilllageComType)]:{prefab:e.VillageComPrefabPath,preview:"source/building/villageCom.png",realWidth:300,realHeight:300,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"农学堂",costTree:4,costStone:4,desc:"可以增加采集食物水源速度"},[String(s.BuildingType.BloodBuildingType)]:{prefab:e.BloodBuildingPrefabPath,preview:"source/building/blood_building.png",realWidth:350,realHeight:350,createBuildingSpeed:2e3,useBuildingTime:5e3,createPriority:1,buildingName:"养生堂",costTree:3,costStone:3,desc:"可以恢复少量生命值"}};class a{static randomPointInRect(e,t,i,n){return{x:e+Math.random()*i,y:t+Math.random()*n}}static randomByArea(e,t,i){let n=a.randomSign(),s=a.randomSign(),o=e+n*Math.random()*i,r=t+s*Math.random()*i;return{x:Math.floor(o),y:Math.floor(r)}}static randomByArea2(e,t,i,n,s,o,r){let d=a.randomByArea(e,t,i);return d.x<o?d.x=o:d.x>n-o&&(d.x=n-o),d.y<r?d.y=r:d.y>s-r&&(d.y=s-r),{x:Math.floor(d.x),y:Math.floor(d.y)}}static randomByArea3(e,t,i,n){let s=i+Math.random()*(n-i),a=360*Math.random(),o=Math.sin(a)*s,r=Math.cos(a)*s;return{x:Math.floor(r+e),y:Math.floor(o+t)}}static randomYes(e){return null==e&&(e=.5),Math.random()>=e}static randomSign(){return Math.random()>=.5?1:-1}static randomNumber(e,t){let i=Math.random();return e+Math.round(i*(t-e))}static randomPointForXWithSign(e,t,i){return{x:e+a.randomSign()*Math.round(Math.random()*i),y:t}}static randomPointForX(e,t,i){return{x:e+Math.round(Math.random()*i),y:t}}static randomSex(){return Math.random()>.5?1:2}static randomACellInArray(e){if(0==e.length)return null;return e[a.randomNumber(0,e.length-1)]}}class o{}o.MapSideOff=0,o.startSeason=0,o.GameTimeStep=500,o.Seasons=["#c8eea0","#8ef325","#e2f324","#e7e8d4"];class r{static obtainResidentState(){for(const e in r.ResidentState)r.ResidentState[e]=e}}r.ResidentState={NullState:"",IdleState:"",FindBlockForCreateHome:"",GotoContinueCreateHome:"",CreateHome:"",FindBlockForCreateFire:"",GotoContinueCreateFire:"",CreateFire:"",FindTree:"",CutDownTree:"",FindStone:"",CollectStone:"",FindFood:"",EatFood:"",FindWater:"",DrinkWater:"",LoverMan:"",LoverWoman:"",LoverGoHomeMakeLove:"",LoverMakeLove:"",JoinTalking:"",TalkingAbout:"",JoinHunt:"",Hunting:"",Die:"",GotoContinueCreateHospital:"",CreateHospital:"",GotoContinueCreateVillageCom:"",CreateVillageCom:"",GotoVillageCom:"",UpdateFarmSpeed:"",GotoContinueCreateSpeedBuilding:"",CreateSpeedBuilding:"",GotoContinueCreateToolBuilding:"",CreateToolBuilding:"",GotoToolBuilding:"",UpdateTool:"",GotoTreat:"",Treating:"",GotoOperaForWatch:"",WatchOpera:"",GotoSpeedBuildingForAddSpeed:"",AddSpeed:"",GotoContinueCreateSchool:"",CreateSchool:"",GoToSchool:"",Learning:"",GotoContinueCreateFarmLand:"",CreateFarmLand:"",GotoContinueCreatePasture:"",CreatePasture:"",GotoContinueCreateOpera:"",CreateOpera:"",JoinFight:"",Fighting:"",GotoContinueCreateLab:"",CreateLab:"",GotoContinueCreateBloodBuilding:"",CreateBloodBuilding:"",GotoBloodBuilding:"",AddBlood:"",GotoContinueCreateOffice:"",CreateOffice:"",RandomWalk:"",GotoContinueCreateChildSchool:"",CreateChildSchool:"",GotoChildSchoolForLearn:"",ChildLearn:"",GotoContinueCreateFoodPool:"",CreateFoodPool:"",GotoContinueCreateWaterPool:"",CreateWaterPool:"",FindFoodForSend:"",CollectFood:"",SendFoodToFoodPool:"",FindWaterForSend:"",CollectWater:"",SendWaterToWaterPool:"",GotoFoodPoolForEat:"",EatFoodInFoodPool:"",GotoWaterPoolForDrink:"",DrinkWaterInWaterPool:"",GotoFireForHeating:"",Heating:"",GoToOfficeForWork:"",Working:""},r.obtainResidentState(),r.ResidentGOtoSomeWhereDoSomeThingAIMap={[r.ResidentState.FindFood]:{nextState:r.ResidentState.EatFood},[r.ResidentState.FindWater]:{nextState:r.ResidentState.DrinkWater},[r.ResidentState.FindTree]:{nextState:r.ResidentState.CutDownTree},[r.ResidentState.FindStone]:{nextState:r.ResidentState.CollectStone}},r.ResidentFindCreateBuildingBlockAIMap={[r.ResidentState.FindBlockForCreateHome]:{buildingType:s.BuildingType.HomeType,nextState:r.ResidentState.GotoContinueCreateHome},[r.ResidentState.FindBlockForCreateFire]:{buildingType:s.BuildingType.FireType,nextState:r.ResidentState.GotoContinueCreateFire}},r.ResidentContinueCreateMap={[r.ResidentState.GotoContinueCreateHome]:{nextState:r.ResidentState.CreateHome,buildingType:s.BuildingType.HomeType,isContinueCreate:!1},[r.ResidentState.GotoContinueCreateFire]:{nextState:r.ResidentState.CreateFire,buildingType:r.ResidentState.FireType,isContinueCreate:!1},[r.ResidentState.GotoContinueCreateHospital]:{nextState:r.ResidentState.CreateHospital,buildingType:s.BuildingType.HospitalType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreateSchool]:{nextState:r.ResidentState.CreateSchool,buildingType:s.BuildingType.SchoolType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreateFarmLand]:{nextState:r.ResidentState.CreateFarmLand,buildingType:s.BuildingType.FarmLandType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreatePasture]:{nextState:r.ResidentState.CreatePasture,buildingType:s.BuildingType.PastureType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreateOpera]:{nextState:r.ResidentState.CreateOpera,buildingType:s.BuildingType.OperaType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreateLab]:{nextState:r.ResidentState.CreateLab,buildingType:s.BuildingType.LabType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreateOffice]:{nextState:r.ResidentState.CreateOffice,buildingType:s.BuildingType.OfficeType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreateChildSchool]:{nextState:r.ResidentState.CreateChildSchool,buildingType:s.BuildingType.ChildSchoolType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreateFoodPool]:{nextState:r.ResidentState.CreateFoodPool,buildingType:s.BuildingType.FoodPoolType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreateWaterPool]:{nextState:r.ResidentState.CreateWaterPool,buildingType:s.BuildingType.WaterPoolType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreateSpeedBuilding]:{nextState:r.ResidentState.CreateSpeedBuilding,buildingType:s.BuildingType.SpeedBuildingType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreateToolBuilding]:{nextState:r.ResidentState.CreateToolBuilding,buildingType:s.BuildingType.ToolBuildingType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreateVillageCom]:{nextState:r.ResidentState.CreateVillageCom,buildingType:s.BuildingType.VilllageComType,isContinueCreate:!0},[r.ResidentState.GotoContinueCreateBloodBuilding]:{nextState:r.ResidentState.CreateBloodBuilding,buildingType:s.BuildingType.BloodBuildingType,isContinueCreate:!0}},r.ResidentUseBuildingMap={[r.ResidentState.GotoTreat]:{nextState:r.ResidentState.Treating,buildingType:s.BuildingType.HospitalType,useType:1},[r.ResidentState.GotoOperaForWatch]:{nextState:r.ResidentState.WatchOpera,buildingType:s.BuildingType.OperaType,useType:1},[r.ResidentState.GoToSchool]:{nextState:r.ResidentState.Learning,buildingType:s.BuildingType.SchoolType,useType:1},[r.ResidentState.GotoChildSchoolForLearn]:{nextState:r.ResidentState.ChildLearn,buildingType:s.BuildingType.ChildSchoolType,useType:1},[r.ResidentState.GotoFoodPoolForEat]:{nextState:r.ResidentState.EatFoodInFoodPool,buildingType:s.BuildingType.FoodPoolType,useType:1},[r.ResidentState.GotoWaterPoolForDrink]:{nextState:r.ResidentState.DrinkWaterInWaterPool,buildingType:s.BuildingType.WaterPoolType,useType:1},[r.ResidentState.GotoFireForHeating]:{nextState:r.ResidentState.Heating,buildingType:s.BuildingType.FireType,useType:2},[r.ResidentState.GotoSpeedBuildingForAddSpeed]:{nextState:r.ResidentState.AddSpeed,buildingType:s.BuildingType.SpeedBuildingType,useType:1},[r.ResidentState.GoToOfficeForWork]:{nextState:r.ResidentState.Working,buildingType:s.BuildingType.OfficeType,useType:1},[r.ResidentState.GotoToolBuilding]:{nextState:r.ResidentState.UpdateTool,buildingType:s.BuildingType.ToolBuildingType,useType:1},[r.ResidentState.GotoVillageCom]:{nextState:r.ResidentState.UpdateFarmSpeed,buildingType:s.BuildingType.VilllageComType,useType:1}},r.ResidentSendAIMap={[r.ResidentState.FindFoodForSend]:{collectState:r.ResidentState.CollectFood,lastState:r.ResidentState.SendFoodToFoodPool,buildingType:s.BuildingType.FoodPoolType},[r.ResidentState.FindWaterForSend]:{collectState:r.ResidentState.CollectWater,lastState:r.ResidentState.SendWaterToWaterPool,buildingType:s.BuildingType.WaterPoolType}},r.ResidentAnim={Null:0,Idle:1,Walk:2,Enjoy:3,Work:4,Die:5,Anger:6},r.CutDownTreeTime=1e4,r.CollectStoneTime=2e4,r.ResidentMoveSpeed=4,r.SocialTimeStep=1e3,r.SocialFightStep=1e3,r.DieTime=2e3,r.MakeLoveMaxDeltay=1e4,r.ResidentNumPerHome=3,r.ResidentValueStep=1e3,r.ResidentMakeIdeaStep=1e3,r.ResidentReduceWaterBaseValue=-.3,r.ResidentReduceFoodBaseValue=-.25,r.ResidentReduceSocialBaseValue=-.4,r.ResidentAddSocialBaseValue=60,r.ResidentReduceLifeBaseValue=-.5,r.ResidentReduceEnjoyBaseValue=-.25,r.ResidentSickProbability=.999,r.ResidentTreatTime=1e4,r.ResidentLearnTime=5e3,r.ResidentLearnTimeForChildLearn=1e4,r.ResidentSocialLowToFight=20,r.ResidentFightReduceValue=20,r.ResidentSocialNeedValue=50,r.ResidentWaterNeedValue=20,r.ResidentFoodNeedValue=20,r.ResidentEnjoyNeedValue=30,r.ResidentSocialArea=2e3,r.ResidentFightArea=500,r.ResidentFightNum=10,r.ResidentAddTreeBaseValue=1,r.ResidentAddStoneBaseValue=1,r.ResidentFindPathTimes=20,r.ResidentAdultAge=5,r.ResidentMarryAge=r.ResidentAdultAge+2,r.ResidentAgePeriod=5e4,r.ResidentGotoYOff=10,r.ResidentChildSchoolSearchArea=1e3,r.ResidentCollectSendTime=1e4,r.ResidentDrinkWaterAddValue=50,r.ResidentSaveWaterAddValue=100,r.ResidentStandardTemperature=36,r.ResidentDangerTemperature=30,r.ResidentReduceTemperatureValue=1,r.ResidentReduceTemperatureTickStep=50;class d{}d.AnimalMaxNumPerTrigger=1,d.AnimalTriggerArea=50,d.AnimalUpdateTime=9e4,d.AnimalZOrder=99,d.AnimalMoveSpeed=50,d.AnimalLife=100,d.AnimalHurtTime=1e4,d.AnimalState={NullState:0,Idle:1,Hurt:2,Walk:3,Die:4};class l extends Laya.Script{constructor(){super(),this.animalId=0,this.x=0,this.y=0,this.attackMaxNum=2,this.curAttackNum=0,this.life=d.AnimalLife,this.state=d.AnimalState.NullState,this.huntResidentIds=new Set([])}addHuntResidentIds(e){this.huntResidentIds.add(e)}getHuntResidentIds(){return this.huntResidentIds}clearHuntResidentIds(){this.huntResidentIds.clear()}updateData(e){e&&(e.x&&(this.x=e.x),e.y&&(this.y=e.y),e.animalId&&(this.animalId=e.animalId))}setAttackNum(e){this.curAttackNum=e,this.curAttackNum>this.attackMaxNum?this.curAttackNum=this.attackMaxNum:this.curAttackNum<0&&(this.curAttackNum=0)}getAttackNum(){return this.curAttackNum}addAttackNum(e){this.setAttackNum(this.getAttackNum()+e)}getAttackMaxNum(){return this.attackMaxNum}getX(){return this.x}getY(){return this.y}getAnimalId(){return this.animalId}setState(e){this.state=e}getState(){return this.state}}class h extends Laya.Script{constructor(){super(),this.buildingId=0,this.x=0,this.y=0,this.buildingType=s.BuildingType.NullTyupe,this.buildingState=s.BuildingState.NullState,this.exteraData={}}setExteraData(e,t){this.exteraData[e]=t}getExteraData(e){return this.exteraData[e]}getBuildingType(){return this.buildingType}getBuildingId(){return this.buildingId}setBuildingState(e){this.buildingState=e}getBuildingState(){return this.buildingState}getX(){return this.x}getY(){return this.y}updateData(e){e&&(e.x&&(this.x=e.x),e.y&&(this.y=e.y),e.buildingId&&(this.buildingId=e.buildingId),e.buildingType&&(this.buildingType=e.buildingType),e.buildingState&&(this.buildingState=e.buildingState))}}class g extends Laya.Script{constructor(){super(),this.x=0,this.y=0,this.area=0,this.fightPointId=0,this.fightNum=0,this.fightMaxNum=0}getFightPointId(){return this.fightPointId}getFightPosInArea(){return a.randomByArea(this.x,this.y,this.area)}getX(){return this.x}getY(){return this.y}addFightNum(e){this.setFightNum(this.getFightNum()+e)}setFightNum(e){this.fightNum=e}getFightNum(){return this.fightNum}getFightMaxNum(){return this.fightMaxNum}updateData(e){e&&(e.x&&(this.x=e.x),e.y&&(this.y=e.y),e.area&&(this.area=e.area),e.fightPointId&&(this.fightPointId=e.fightPointId),e.fightMaxNum&&(this.fightMaxNum=e.fightMaxNum))}}class c{static obtainFoodState(){for(const e in c.FoodState)c.FoodState[e]=e}}c.FoodMaxNumPerTrigger=2,c.FoodUpdateTime=4e4,c.FoodZOrder=99,c.DrinkWaterTime=5e3,c.FoodTypes={NullType:0,FruitType:1,MeatType:2},c.FoodAddValue={[c.FoodTypes.FruitType]:{deltayTime:5e3,addValue:90},[c.FoodTypes.MeatType]:{deltayTime:5e3,addValue:120}},c.FoodState={CanEat:"",Occupy:"",Eating:""},c.obtainFoodState();class u extends Laya.Script{constructor(){super(),this.food=0,this.foodId=0,this.x,this.y,this.foodType=c.FoodTypes.NullType,this.state=c.FoodState.CanEat,this.eatFinishTime=0}getFoodType(){return this.foodType}setFoodType(e){this.foodType=e}getFoodId(){return this.foodId}getX(){return this.x}getY(){return this.y}getFoodState(){return this.state}setFoodState(e){this.state=e}getFood(){return this.food}getEatCDTime(){return c.FoodAddValue[this.foodType].deltayTime}updateData(e){e&&(e.food&&(this.food=e.food),e.x&&(this.x=e.x),e.y&&(this.y=e.y),e.foodId&&(this.foodId=e.foodId),e.foodType&&(this.foodType=e.foodType,this.food=c.FoodAddValue[this.foodType].addValue))}}class S{constructor(){this.eventDispatcher=new Laya.EventDispatcher}static getInstance(){return S.instance?S.instance:S.instance=new S}postEvent(e,t){this.eventDispatcher.event(e,t)}registEvent(e,t,i,n){this.removeEvent(e,t,i),this.eventDispatcher.on(e,t,i,n)}removeEvent(e,t,i){this.eventDispatcher.off(e,t,i,!1)}removeEventAll(e){this.eventDispatcher.offAll(e)}offAllCaller(e){this.eventDispatcher.offAllCaller(e)}removeAllEvent(){this.eventDispatcher.offAll(eventName)}}class p{static getSystemTime(){let e=new Date,t=e.getTimezoneOffset();return e.getTime()+60*t*1e3}}class m{}m.CREATE_BUILDING_FINISH="CREATE_BUILDING_FINISH",m.HUNT_FINISH="HUNT_FINISH",m.RESIDENT_SICK="RESIDENT_SICK",m.RESIDENT_DIE="RESIDENT_DIE",m.RESIDENT_GROWUP="RESIDENT_GROWUP";class y{static randomOneName(){let e=Math.random(),t=Math.floor(e*y.FirstName.length),i=Math.floor(e*y.LastName.length);return y.FirstName[t]+y.LastName[i]}}y.FirstName=["孙","沈","李","王","赵","司马","诸葛","周"],y.LastName=["文","建蕊","二狗","狗胜","桂芬","翠萍","秀姑","大壮","Joel","Season","Jack","大壮","钢弹","见章","荣发","德柱","三姐","素贞"];class f extends Laya.Script{constructor(){super(),this.life=100,this.water=100,this.enjoy=0,this.food=100,this.teach=0,this.social=100,this.positive=.6,this.myHomeId=0,this.isInChildSchool=!1,this.ageExp=0,this.makeLoveSystemTime=0,this.petType=0,this.speedScale=1,this.collectionScale=1,this.farmScale=1,this.temperature=r.ResidentStandardTemperature,this.temperatureTick=0,this.age=1,this.sex=1,this.married=1,this.sick=1,this.isWorking=!1,this.residentName=y.randomOneName(),this.x=0,this.y=0,this.residentId=0,this.curFSMState=r.ResidentState.NullState}updateData(e){e&&(e.life&&(this.life=e.life),e.water&&(this.water=e.water),e.enjoy&&(this.enjoy=e.enjoy),e.food&&(this.food=e.food),e.teach&&(this.teach=e.teach),e.social&&(this.social=e.social),e.myHomeId&&(this.myHomeId=e.myHomeId),e.temperature&&(this.temperature=e.temperature),e.age&&(this.age=e.age),e.sex&&(this.sex=e.sex),e.married&&(this.married=e.married),e.residentName&&(this.residentName=e.residentName),e.x&&(this.x=e.x),e.y&&(this.y=e.y),e.residentId&&(this.residentId=e.residentId),e.curFSMState&&(this.curFSMState=e.curFSMState),e.sick&&(this.sick=e.sick),e.positive&&(this.positive=e.positive),e.ageExp&&(this.ageExp=e.ageExp),e.petType&&(this.petType=e.petType),e.speedScale&&(this.speedScale=e.speedScale))}setIsWorking(e){this.isWorking=e}getIsWorking(){return this.isWorking}setFarmScale(e){this.farmScale=e}getFarmScale(){return this.farmScale}setCollectionSpeedScale(e){this.collectionScale=e}getCollectionSpeedScale(){return this.collectionScale}setSpeedScale(e){this.speedScale=e}getSpeedScale(){return this.speedScale}addTemperature(e){this.setTemperature(this.getTemperature()+e)}getTemperature(){return this.temperature}setTemperature(e){this.temperature=e,this.temperature<30&&(this.temperature=30)}setPetType(e){this.petType=e}getPetType(){return this.petType}recordMakeLoveSystemTime(){0==this.makeLoveSystemTime&&(this.makeLoveSystemTime=p.getSystemTime())}getMakeLoveSystemTime(){return this.makeLoveSystemTime}addAgeExp(e,t){if(this.setAgeExp(this.getAgeExp()+e),this.ageExp>=r.ResidentAgePeriod){let e=this.age,i=this.ageExp%r.ResidentAgePeriod;if(this.addAge(Math.floor(this.ageExp/r.ResidentAgePeriod)),this.ageExp=i,e<r.ResidentAdultAge&&this.age>=r.ResidentAdultAge)return t&&S.getInstance().postEvent(m.RESIDENT_GROWUP,this),!0}return!1}setAgeExp(e){this.ageExp=e}getAgeExp(){return this.ageExp}getSick(){return this.sick}setSick(e){this.sick=e}setLoverId(e){this.loverId=e}getLoverId(){return this.loverId}getResidentId(){return this.residentId}getFSMState(){return this.curFSMState}setFSMState(e){this.curFSMState=e}getMarried(){return this.married}setMarried(e){this.married=e}setAge(e){this.age=e}getAge(){return this.age}addAge(e){this.setAge(this.getAge()+e)}setMyHomeId(e){this.myHomeId=e}getMyHomeId(){return this.myHomeId}onStep(e){p.getSystemTime()>=this.getMakeLoveSystemTime()+r.MakeLoveMaxDeltay&&(this.makeLoveSystemTime=0),3==e.gameSeason?(this.temperatureTick++,this.temperatureTick>r.ResidentReduceTemperatureTickStep&&(this.addTemperature(-r.ResidentReduceTemperatureValue),this.temperatureTick=0)):(this.temperatureTick=0,this.setTemperature(r.ResidentStandardTemperature)),this.addAgeExp(r.ResidentMakeIdeaStep,!0),this.getLife()<=0&&this.getFSMState()==r.ResidentState.IdleState?S.getInstance().postEvent(m.RESIDENT_DIE,this):(this.addEnjoy(r.ResidentReduceEnjoyBaseValue),this.addSocial(r.ResidentReduceSocialBaseValue),this.addWater(r.ResidentReduceWaterBaseValue),this.addFood(r.ResidentReduceFoodBaseValue),1==this.getSick()&&Math.random()>r.ResidentSickProbability&&(this.setSick(2),S.getInstance().postEvent(m.RESIDENT_SICK,this)),(this.food<=0||this.water<=0||2==this.getSick()||this.temperature<r.ResidentDangerTemperature)&&(2==this.getSick()?this.addLife(1.5*r.ResidentReduceLifeBaseValue):this.addLife(r.ResidentReduceLifeBaseValue)))}canAskMarry(){return 0==this.getMakeLoveSystemTime()&&this.getAge()>=r.ResidentMarryAge&&1==this.getSex()&&0!=this.getMyHomeId()&&this.getSocial()>=20&&this.getFSMState()==r.ResidentState.IdleState}canMarry(e){return 2==this.getSex()&&0==this.getMakeLoveSystemTime()&&this.getAge()>r.ResidentMarryAge&&this.getFSMState()==r.ResidentState.IdleState}addEnjoy(e){this.setEnjoy(this.getEnjoy()+e)}setEnjoy(e){this.enjoy=e,this.enjoy<0?this.enjoy=0:this.enjoy>100&&(this.enjoy=100)}getEnjoy(){return this.enjoy}addSocial(e){this.setSocial(this.getSocial()+e)}setSocial(e){this.social=e,this.social<0?this.social=0:this.social>100&&(this.social=100)}getSocial(){return this.social}getTeach(){return this.teach}addTeach(e){this.setTeach(this.getTeach()+e)}setTeach(e){this.teach=e,this.teach<0?this.teach=0:this.teach>100&&(this.teach=100)}getLife(){return this.life}addLife(e){this.setLife(this.getLife()+e)}setLife(e){this.life=e,this.life<0?this.life=0:this.life>100&&(this.life=100)}getFood(){return this.food}addFood(e){this.setFood(this.getFood()+e)}setFood(e){this.food=e,this.food<0?this.food=0:this.food>100&&(this.food=100)}addWater(e){this.setWater(this.getWater()+e)}setWater(e){this.water=e,this.water<0?this.water=0:this.water>100&&(this.water=100)}getPositive(){return this.positive}getWater(){return this.water}addWater(e){this.setWater(this.getWater()+e)}getSex(){return this.sex}getX(){return this.x}getY(){return this.y}isAdult(){return this.age>=r.ResidentAdultAge}}class T extends Laya.Script{constructor(){super(),this.x=0,this.y=0,this.area=0,this.talkingPointId=0,this.talkingNum=0,this.talkingMaxNum=0}getTalkingPointId(){return this.talkingPointId}getTalkingPosInArea(){return a.randomByArea(this.x,this.y,this.area)}getX(){return this.x}getY(){return this.y}addTalkingNum(e){this.setTalkingNum(this.getTalkingNum()+e)}setTalkingNum(e){this.talkingNum=e}getTalkingNum(){return this.talkingNum}getTalkingMaxNum(){return this.talkingMaxNum}updateData(e){e&&(e.x&&(this.x=e.x),e.y&&(this.y=e.y),e.area&&(this.area=e.area),e.talkingPointId&&(this.talkingPointId=e.talkingPointId),e.talkingMaxNum&&(this.talkingMaxNum=e.talkingMaxNum))}}class L extends Laya.Script{constructor(){super(),this.maxResidentID=0,this.maxFoodID=0,this.maxBuildingID=0,this.maxTalkingID=0,this.maxFightID=0,this.maxAnimalID=0,this.residentModels={},this.foodModels={},this.buildingModels={},this.talkingPoints={},this.fightPoints={},this.animalModes={},this.treeNum=0,this.stoneNum=0,this.goldNum=0,this.elecNum=0,this.gameYear=0,this.gameDay=0,this.gameSeason=o.startSeason,this.gameHour=0}onEnable(){}onDisable(){}static getInstance(){return L.instance?L.instance:(L.instance=new L,L.instance.initSelf(),L.instance)}getAllChildResidentNum(){let e=0;for(let t in this.residentModels){this.residentModels[t].isAdult()||e++}return e}getHomeNum(){let e=0;for(const t in this.buildingModels){this.buildingModels[t].getBuildingType()==s.BuildingType.HomeType&&e++}return e}getAllResidentNum(){return Object.keys(this.residentModels).length}getGameSeason(){return this.gameSeason}getGameDay(){return this.gameDay}getGameHour(){return this.gameHour}getTreeNum(){return this.treeNum}setTreeNum(e){this.treeNum=e,this.treeNum<0&&(this.treeNum=0)}addTreeNum(e){this.setTreeNum(this.getTreeNum()+e)}setStoneNum(e){this.stoneNum=e,this.stoneNum<0&&(this.stoneNum=0)}getStoneNum(){return this.stoneNum}addStoneNum(e){this.setStoneNum(this.getStoneNum()+e)}setGoldNum(e){this.goldNum=e,this.goldNum<0&&(this.goldNum=0)}getGoldNum(){return this.goldNum}addGoldNum(e){this.setGoldNum(this.getGoldNum()+e)}setElecNum(e){this.elecNum=e,this.elecNum<0&&(this.elecNum=0)}getElecNum(){return this.elecNum}addElecNum(e){this.setElecNum(this.getElecNum()+e)}newAnimalModel(e){this.maxAnimalID++;let t=new l;return t.updateData({x:e.x,y:e.y,animalId:this.maxAnimalID}),this.animalModes[String(this.maxAnimalID)]=t,t}removeAnimalModel(e){this.animalModes[String(e)]}getBuildingModel(e){return this.buildingModels[String(e)]}getOrCreateTalkingPoint(e,t,i,n){for(const i in this.talkingPoints){let n=this.talkingPoints[i],s=new Laya.Point(e,t).distance(n.getX(),n.getY());if(n.getTalkingNum()<n.getTalkingMaxNum()&&s<=r.ResidentSocialArea)return n}return this.newTalkingPoint(e,t,i,n)}removeTalkingPoint(e){this.talkingPoints[String(e)].destroy(!0),delete this.talkingPoints[String(e)]}newTalkingPoint(e,t,i,n){this.maxTalkingID++;let s=new T;return s.updateData({x:e,y:t,area:i,talkingPointId:this.maxTalkingID,talkingMaxNum:n}),this.talkingPoints[String(this.maxTalkingID)]=s,s}getOrCreateFightPoint(e,t,i,n){for(const i in this.fightPoints){let n=this.fightPoints[i],s=new Laya.Point(e,t).distance(n.getX(),n.getY());if(n.getFightNum()<n.getFightMaxNum()&&s<=r.ResidentFightArea)return n}return this.newFightPoint(e,t,i,n)}removeFightPoint(e){this.fightPoints[String(e)].destroy(!0),delete this.fightPoints[String(e)]}newFightPoint(e,t,i,n){this.maxFightID++;let s=new g;return s.updateData({x:e,y:t,area:i,fightPointId:this.maxFightID,fightMaxNum:n}),this.fightPoints[String(this.maxFightID)]=s,s}newBuildingModel(e){this.maxBuildingID++;let t=new h;return t.updateData({x:e.x,y:e.y,buildingId:this.maxBuildingID,buildingType:e.buildingType,buildingState:s.BuildingState.PreCreating}),this.buildingModels[String(this.maxBuildingID)]=t,t}newFoodModel(e){this.maxFoodID++;let t=new u;return t.updateData({x:e.x,y:e.y,foodId:this.maxFoodID,foodType:e.foodType}),this.foodModels[String(this.maxFoodID)]=t,t}removeFoodModelById(e){delete this.foodModels[String(e)]}randomSex(){let e=this.getAllChildResidentNum();return e<6?e%2==0?1:2:a.randomSex()}setMarried(e,t){e.setMarried(2),t.setMarried(2),e.setLoverId(t.getResidentId()),t.setLoverId(e.getResidentId()),t.setMyHomeId(e.getMyHomeId())}newResidentModel(e){this.maxResidentID++;let t=new f;return e.residentId=this.maxResidentID,t.updateData(e),this.residentModels[String(this.maxResidentID)]=t,t}removeResientModel(e){delete this.residentModels[String(e)]}removeBuildingModel(e){delete this.buildingModels[String(e)]}onUpdateResidentValue(){for(let e in this.residentModels){this.residentModels[e].onStep({gameSeason:this.gameSeason})}}onGameTimeStep(){this.gameHour+=1,this.gameHour>=24&&(this.gameDay+=1,this.gameHour=0),this.gameDay>=30&&(this.gameDay=0,this.gameSeason+=1),this.gameSeason>=4&&(this.gameYear+=1,this.gameSeason=0)}initSelf(){Laya.timer.loop(r.ResidentValueStep,this,this.onUpdateResidentValue),Laya.timer.loop(o.GameTimeStep,this,this.onGameTimeStep)}}class w extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.buildingScript=this.owner.selectedBuilding.buildingScript,this.buildingModel=this.buildingScript.getModel(),this.yesBtn=this.owner.getChildByName("yesBtn"),this.yesBtn.on(Laya.Event.CLICK,this,function(){let e=s.BuildingDatas[s.BuildingType.ChildSchoolType].teachers[this.teacherIndex];if(L.getInstance().getGoldNum()>=e.costGold){if(this.teacherIndex==this.selectTeacherIndex)return void n.getInstance().showTip("老师正在上班中~");this.selectTeacherIndex=this.teacherIndex,L.getInstance().addGoldNum(-e.costGold),this.buildingScript.setChildTeacherIndex(this.selectTeacherIndex),this.refreshTeacher()}else n.getInstance().showTip("钱不够啦~")}),this.closeBtn=this.owner.getChildByName("closeBtn"),this.closeBtn.on(Laya.Event.CLICK,this,function(){Laya.Dialog.close(e.ChildSchoolDialogScenePath)}),this.teacherIndex=this.buildingScript.getChildTeacherIndex(),this.selectTeacherIndex=this.buildingScript.getChildTeacherIndex(),this.leftBtn=this.owner.getChildByName("leftBtn"),this.leftBtn.on(Laya.Event.CLICK,this,function(){this.teacherIndex--,this.refreshTeacher()}),this.rightBtn=this.owner.getChildByName("rightBtn"),this.rightBtn.on(Laya.Event.CLICK,this,function(){this.teacherIndex++,this.refreshTeacher()}),this.refreshTeacher()}refreshTeacher(){let t=s.BuildingDatas[s.BuildingType.ChildSchoolType].teachers;this.teacherIndex<0&&(this.teacherIndex=0),this.teacherIndex>=t.length&&(this.teacherIndex=t.length-1),this.teacherIndex==this.selectTeacherIndex?this.yesBtn.label="上班中":this.yesBtn.label="雇佣",this.leftBtn.visible=0!=this.teacherIndex,this.rightBtn.visible=this.teacherIndex<t.length-1;let i=t[this.teacherIndex];this.owner.getChildByName("nameText").text=i.name,this.owner.getChildByName("descText").text=i.desc,this.owner.getChildByName("costText").text=String(i.costGold);let n=this.owner.getChildByName("teacherPos");this.teacherAni&&(this.teacherAni.destroy(!0),this.teacherAni=null),this.teacherAni=new Laya.Animation,1==i.sex?this.teacherAni.loadAnimation(e.ManAniPath):this.teacherAni.loadAnimation(e.WomanAniPath),this.teacherAni.scaleX=2,this.teacherAni.scaleY=2,this.teacherAni.play(0,!0,"idle"),n.addChild(this.teacherAni)}}class B extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){Laya.timer.clear(this,this.onUpdateMiniGame),Laya.timer.clear(this,this.onTriggerFood)}onStart(){this.buildingScript=this.owner.selectedBuilding.buildingScript,this.buildingModel=this.buildingScript.getModel(),this.closeBtn=this.owner.getChildByName("closeBtn"),this.closeBtn.on(Laya.Event.CLICK,this,function(){Laya.Dialog.close(e.FarmLandDialogScenePath)}),this.descText=this.owner.getChildByName("descText"),this.initMiniGame()}initMiniGame(){this.root=this.owner.getChildByName("root"),this.foodId=0,this.foods={},Laya.timer.frameLoop(1,this,this.onUpdateMiniGame),Laya.timer.loop(150,this,this.onTriggerFood),this.root.on(Laya.Event.MOUSE_DOWN,this,function(){let e=Laya.stage.mouseX,t=Laya.stage.mouseY;for(const i in this.foods){let n=this.foods[i];if(n.hitTestPoint(e,t)){this.onTouchDownFood(n),n.destroy(!0),delete this.foods[i];break}}})}triggerFood(){let e=a.randomNumber(1,6);if(2==e)return;let t="source/landscape/food"+String(e)+".png",i=new Laya.Image;i.loadImage(t),i.anchorX=.5,i.anchorY=.5,i.scaleX=1.5,i.scaleY=1.5,this.root.addChild(i),this.foodId++,this.foods[String(this.foodId)]=i;let n=a.randomNumber(100,this.root.width-100);i.x=n,i.y=0;let s=a.randomNumber(6,12);i.speed=s,i.rotation=a.randomNumber(0,359)}onTouchDownFood(e){let t=s.BuildingDatas[String(s.BuildingType.FarmLandType)].gameAddFood;this.buildingScript.addFoodToPool(t)}onTriggerFood(){a.randomYes()&&this.triggerFood()}onUpdateMiniGame(){for(const e in this.foods){let t=this.foods[e];if(t.y>this.root.height){t.destroy(!0),delete this.foods[e];break}}for(const e in this.foods){let t=this.foods[e];t.y+=t.speed}let e=this.buildingScript.getCurSaveFood();this.descText.text="当前食物:"+String(e)}}class b extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.buildingScript=this.owner.selectedBuilding.buildingScript,this.buildingModel=this.buildingScript.getModel(),this.closeBtn=this.owner.getChildByName("closeBtn"),this.closeBtn.on(Laya.Event.CLICK,this,function(){Laya.Dialog.close(e.HospitalDialogScenePath)}),this.doctorIndex=0,this.leftBtn=this.owner.getChildByName("leftBtn"),this.leftBtn.on(Laya.Event.CLICK,this,function(){this.doctorIndex--,this.refreshDoctor()}),this.rightBtn=this.owner.getChildByName("rightBtn"),this.rightBtn.on(Laya.Event.CLICK,this,function(){this.doctorIndex++,this.refreshDoctor()}),this.refreshDoctor()}refreshDoctor(){let t=s.BuildingDatas[s.BuildingType.HospitalType].doctors;this.doctorIndex<0&&(this.doctorIndex=0),this.doctorIndex>=t.length&&(this.doctorIndex=t.length-1),this.leftBtn.visible=0!=this.doctorIndex,this.rightBtn.visible=this.doctorIndex<t.length-1;let i=t[this.doctorIndex],n=this.owner.getChildByName("doctorPos");this.doctorAni&&(this.doctorAni.destroy(!0),this.doctorAni=null),this.doctorAni=new Laya.Animation,1==i.sex?this.doctorAni.loadAnimation(e.ManAniPath):this.doctorAni.loadAnimation(e.WomanAniPath),this.doctorAni.scaleX=2,this.doctorAni.scaleY=2,this.doctorAni.play(0,!0,"idle"),n.addChild(this.doctorAni),this.owner.getChildByName("nameText").text=i.name,this.owner.getChildByName("descText").text=i.desc,this.owner.getChildByName("costText").text=String(i.costGold)}}class F extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.buildingScript=this.owner.selectedBuilding.buildingScript,this.buildingModel=this.buildingScript.getModel(),this.closeBtn=this.owner.getChildByName("closeBtn"),this.closeBtn.on(Laya.Event.CLICK,this,function(){Laya.Dialog.close(e.LabDialogScenePath)})}}class x{}x.question=[{question:"沈老师体重是多少？",option:["90斤","100斤","102斤"],answer:2},{question:"吃爆米花会胖么？",option:["不会胖","会胖很多","只有沈老师吃了不会胖"],answer:2}];class C extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){L.getInstance().addGoldNum(Number(this.buildingScript.getCurSaveGold()))}onStart(){this.buildingScript=this.owner.selectedBuilding.buildingScript,this.buildingModel=this.buildingScript.getModel(),this.closeBtn=this.owner.getChildByName("closeBtn"),this.closeBtn.on(Laya.Event.CLICK,this,function(){Laya.Dialog.close(e.OfficeDialogScenePath)}),this.changeBtn=this.owner.getChildByName("changeBtn"),this.changeBtn.on(Laya.Event.CLICK,this,function(){this.roundStart=!0,this.refreshQuestion()}),this.scoreText=this.owner.getChildByName("scoreText"),this.initQuestion()}initQuestion(){this.roundStart=!0,this.answers=[];for(let e=0;e<3;e++){let t=this.owner.getChildByName("a"+String(e));this.answers.push(t),t.on(Laya.Event.CLICK,this,function(){this.onClickAnswer(e)})}this.questionText=this.owner.getChildByName("question"),this.rightText=this.owner.getChildByName("right"),this.refreshQuestion(),this.refreshScoreText()}refreshQuestion(){let e=a.randomNumber(0,x.question.length-1),t=x.question[e];if(null==t||null==t)return;this.questionText.text="问题: "+t.question;for(let e=0;e<3;e++){let i="A. ";1==e?i="B. ":2==e&&(i="C. "),this.answers[e].text=i+t.option[e]}for(const e in this.answers){let t=this.answers[e];t.color="#ea8323",t.typeset()}this.answerIndex=t.answer;let i="正确答案: A";1==this.answerIndex?i="正确答案: B":2==this.answerIndex&&(i="正确答案: C"),this.rightText.text=i,this.rightText.visible=!1}onClickAnswer(e){0!=this.roundStart?(1==this.roundStart&&(this.roundStart=!1),this.answerIndex==e?(this.answers[e].color="#30bc15",this.buildingScript.addGoldToOffice(1)):(this.answers[e].color="#ea234a",this.buildingScript.addGoldToOffice(-1)),this.rightText.visible=!0,this.answers[e].typeset(),this.refreshScoreText()):n.getInstance().showTip("请换一道题~")}refreshScoreText(){this.scoreText.text="当前积分: "+String(this.buildingScript.getCurSaveGold())}}class I extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){Laya.timer.clear(this,this.refreshNum)}onStart(){this.addTouchEnjoy=s.BuildingDatas[s.BuildingType.OperaType].addTouchEnjoy,this.buildingScript=this.owner.selectedBuilding.buildingScript,this.buildingModel=this.buildingScript.getModel(),this.closeBtn=this.owner.getChildByName("closeBtn"),this.closeBtn.on(Laya.Event.CLICK,this,function(){Laya.Dialog.close(e.OperaDialogScenePath)}),this.descText=this.owner.getChildByName("descText"),this.initTouch(),Laya.timer.loop(1e3,this,this.refreshNum),this.refreshNum()}refreshNum(){let e=this.buildingScript.getCurSaveEnjoy();this.descText.text="当前储存快乐值: "+String(e)}initTouch(){this.touchs={};for(let e=0;e<7;e++){let t=this.owner.getChildByName("sound"+String(e+1));this.touchs[String(e+1)]=t,t.getChildByName("num").text=String(e+1);let i=t.getChildByName("state1"),n=t.getChildByName("state2");t.state1=i,t.state2=n,t.on(Laya.Event.MOUSE_DOWN,this,function(){this.onTouchDownControl(e+1,t)}),t.on(Laya.Event.MOUSE_UP,this,function(){this.onTouchUpControl(e+1,t)}),t.on(Laya.Event.MOUSE_OUT,this,function(){this.onTouchUpControl(e+1,t)})}}onTouchDownControl(e,t){t.state2.visible=!1;let i="source/sound/"+String(e)+".mp3";Laya.SoundManager.playSound(i,1),this.buildingScript.addEnjoyToOpera(this.addTouchEnjoy),this.refreshNum()}onTouchUpControl(e,t){t.state2.visible=!0}}class R extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){Laya.timer.clear(this,this.onTriggerBug),Laya.timer.clear(this,this.refreshRemainTimeText)}onStart(){this.buildingScript=this.owner.selectedBuilding.buildingScript,this.buildingModel=this.buildingScript.getModel(),this.closeBtn=this.owner.getChildByName("closeBtn"),this.closeBtn.on(Laya.Event.CLICK,this,function(){Laya.Dialog.close(e.PastureDialogScenePath)}),this.initMiniGame()}initMiniGame(){this.score=0,this.remainTime=25,this.dongs={},this.dongSprs={},this.scoreText=this.owner.getChildByName("scoreText"),this.remainTimeText=this.owner.getChildByName("remainTimeText");for(let e=0;e<3;e++){let t=String(e+1);this.dongs[t]=this.owner.getChildByName("dong"+t)}Laya.timer.loop(1e3,this,this.refreshRemainTimeText),Laya.timer.loop(100,this,this.onTriggerBug),this.refreshScoreText(),this.refreshRemainTimeText()}refreshRemainTimeText(){this.remainTime-=1,this.remainTime<0&&(this.remainTime=0),0==this.remainTime?this.remainTimeText.text="已结束":this.remainTimeText.text="剩余:"+String(this.remainTime)}onTriggerBug(){if(a.randomYes(.8)){let e=a.randomNumber(1,3),t=this.dongSprs[String(e)];if(null==t||null==t){let t=a.randomNumber(1,3),i=new Laya.Sprite;i.loadImage("source/ui/bug"+String(t)+".png");let n=this.dongs[String(e)];n.addChild(i),i.y=n.height,i.state=0,i.destHeight=n.height,i.on(Laya.Event.MOUSE_DOWN,this,function(){i.destroy(!0),delete this.dongSprs[String(e)],this.score++;let t=s.BuildingDatas[String(s.BuildingType.PastureType)].gameAddFood;this.buildingScript.addFoodToPool(t),this.refreshScoreText()})}}}refreshScoreText(){this.scoreText.text="积分: "+String(this.score)}onUpdate(){let e=[];for(const t in this.dongSprs){let i=this.dongSprs[t];if(i)if(2==i.state)i.y<i.destHeight&&(i.y+=40),i.y>=i.destHeight&&(i.destroy(!0),e.push(t));else if(1==i.state){if(null!=i.tickTime&&null!=i.tickTime||(i.tickTime=0),i.tickTime>=10){i.state=2;continue}i.tickTime+=1}else 0==i.state&&(i.y-=30,i.y<0&&(i.y=0,i.state=1,i.tickTime=0))}for(const t in e){let i=e[t];delete this.dongSprs[i]}}}class P extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.buildingScript=this.owner.selectedBuilding.buildingScript,this.buildingModel=this.buildingScript.getModel(),this.yesBtn=this.owner.getChildByName("yesBtn"),this.yesBtn.on(Laya.Event.CLICK,this,function(){let e=s.BuildingDatas[s.BuildingType.SchoolType].teachers[this.teacherIndex];if(L.getInstance().getGoldNum()>=e.costGold){if(this.teacherIndex==this.selectTeacherIndex)return void n.getInstance().showTip("老师正在上班中~");this.selectTeacherIndex=this.teacherIndex,L.getInstance().addGoldNum(-e.costGold),this.buildingScript.setTeacherIndex(this.selectTeacherIndex),this.refreshTeacher()}else n.getInstance().showTip("钱不够啦~")}),this.closeBtn=this.owner.getChildByName("closeBtn"),this.closeBtn.on(Laya.Event.CLICK,this,function(){Laya.Dialog.close(e.SchoolDialogScenePath)}),this.teacherIndex=this.buildingScript.getTeacherIndex(),this.selectTeacherIndex=this.buildingScript.getTeacherIndex(),this.leftBtn=this.owner.getChildByName("leftBtn"),this.leftBtn.on(Laya.Event.CLICK,this,function(){this.teacherIndex--,this.refreshTeacher()}),this.rightBtn=this.owner.getChildByName("rightBtn"),this.rightBtn.on(Laya.Event.CLICK,this,function(){this.teacherIndex++,this.refreshTeacher()}),this.refreshTeacher()}refreshTeacher(){let t=s.BuildingDatas[s.BuildingType.SchoolType].teachers;this.teacherIndex<0&&(this.teacherIndex=0),this.teacherIndex>=t.length&&(this.teacherIndex=t.length-1),this.teacherIndex==this.selectTeacherIndex?this.yesBtn.label="上班中":this.yesBtn.label="雇佣",this.leftBtn.visible=0!=this.teacherIndex,this.rightBtn.visible=this.teacherIndex<t.length-1;let i=t[this.teacherIndex];this.owner.getChildByName("nameText").text=i.name,this.owner.getChildByName("descText").text=i.desc,this.owner.getChildByName("costText").text=String(i.costGold);let n=this.owner.getChildByName("teacherPos");this.teacherAni&&(this.teacherAni.destroy(!0),this.teacherAni=null),this.teacherAni=new Laya.Animation,1==i.sex?this.teacherAni.loadAnimation(e.ManAniPath):this.teacherAni.loadAnimation(e.WomanAniPath),this.teacherAni.scaleX=2,this.teacherAni.scaleY=2,this.teacherAni.play(0,!0,"idle"),n.addChild(this.teacherAni)}}class A{}A.mapWidth=0,A.mapHeight=0,A.mapContainer=null;class M{static getSign(e){return e>0?1:-1}static getSign2(e){return e>0?1:0==e?0:-1}static setMapZOrder(e,t,i){t?e.zOrder=t:(i||(i=0),e.zOrder=Math.round(e.y+e.height+i))}}Number.prototype.zeroPad=Number.prototype.zeroPad||function(e){var t=String(e).length-String(this).length+1;return t>0?new Array(t).join("0")+this:this};class D extends Laya.Script{constructor(){super(),this.movePaths=[],this.curDest=null,this.finishHandler=null}setCallbackFunc(e){this.leftFunc=e.leftFunc,this.rightFunc=e.rightFunc,this.upFunc=e.upFunc,this.downFunc=e.downFunc,this.tickFunc=e.tickFunc}onStart(){}onDestroy(){this.stopGoto()}refreshDirectCallback(){this.curDest&&(this.curDest.x?this.curDest.direct>0?this.rightFunc&&this.rightFunc():this.leftFunc&&this.leftFunc():this.curDest.direct>0?this.downFunc&&this.downFunc():this.upFunc&&this.upFunc())}startGoto(){if(!this.curDest){if(0==this.movePaths.length&&this.finishHandler)return void this.finishHandler.run();this.curDest=this.movePaths[0],this.refreshDirectCallback(),this.lastFrameTime=Laya.Browser.now(),Laya.timer.frameLoop(1,this,this._onFrameUpdate)}}stopGoto(){this.movePaths=[],this.curDest=null,this.lastFrameTime=0,Laya.timer.clear(this,this._onFrameUpdate)}gotoDest(e,t){this.finishHandler=t,e.speed?this.speed=e.speed:this.speed=r.ResidentMoveSpeed;let i=Math.round(e.x),n=Math.round(e.y),s=i-Math.round(this.owner.x),o=n-Math.round(this.owner.y);0==s&&0==o&&this.finishHandler&&this.finishHandler.run();let d=M.getSign2(s),l=M.getSign2(o);if(e.forceFirstY||a.randomYes()&&(null==e.forceFirstY||null==e.forceFirstY)){let t={y:n,direct:l},s={x:i,direct:d};0!=l&&this.movePaths.push(t),0!=d&&this.movePaths.push(s),e.isFirstY=!0}else{let t={x:i,direct:d},s={y:n,direct:l};0!=d&&this.movePaths.push(t),0!=l&&this.movePaths.push(s),e.isFirstY=!1}this.startGoto()}_onFrameUpdate(){let e=Laya.Browser.now()-this.lastFrameTime;this._onTick(e),this.lastFrameTime=Laya.Browser.now()}_onTick(e){null!=this.curDest.x&&null!=this.curDest.x?M.getSign2(this.curDest.x-this.owner.x)==this.curDest.direct?this.owner.x+=this.curDest.direct*this.speed*e/30:(this.owner.x=this.curDest.x,this.movePaths.splice(0,1),0!=this.movePaths.length?(this.curDest=this.movePaths[0],this.refreshDirectCallback()):(this.stopGoto(),this.finishHandler&&this.finishHandler.run())):M.getSign2(this.curDest.y-this.owner.y)==this.curDest.direct?this.owner.y+=this.curDest.direct*this.speed*e/30:(this.owner.y=this.curDest.y,this.movePaths.splice(0,1),0!=this.movePaths.length?(this.curDest=this.movePaths[0],this.refreshDirectCallback()):(this.stopGoto(),this.finishHandler&&this.finishHandler.run()))}}class v{static randomOneBoredTip(){let e=Math.random(),t=Math.floor(e*v.BoredTips.length);return v.BoredTips[t]}}v.BoredTipsProbability=.9,v.BoredTips=["不想努力了","好开心","我想吃软饭","我想喝啤酒","太无聊了","快去谈恋爱","光棍一个"];class N extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.model=this.owner.residentLogicScript.getModel()}getModel(){return this.model}makeIdea(){this.getModel().getFSMState()==r.ResidentState.IdleState&&a.randomYes(this.getModel().getPositive())&&(a.randomYes(v.BoredTipsProbability)&&this.owner.residentLogicScript.showTip(v.randomOneBoredTip()),this.processResult(),this.doResult())}processResult(){this.level1Results=[],this.level2Results=[],this.owner.lookForLoverScript.processLookForLover(this.level1Results,this.level2Results),this.owner.fightScript.processFight(this.level1Results,this.level2Results),this.owner.huntScript.processHunt(this.level1Results,this.level2Results),this.owner.useBuildingScript.processUseBuildingAI(this.level1Results,this.level2Results),this.owner.socialScript.processSocial(this.level1Results,this.level2Results),this.owner.findBlockForCreateScript.processResidentFindCreateBuildingBlockAI(this.level1Results,this.level2Results),this.owner.randomWalkScript.processRandomWalk(this.level1Results,this.level2Results),this.owner.doSomeThingScript.processDoSomeThing(this.level1Results,this.level2Results),this.owner.createBuildingScript.processCreateBuilding(this.level1Results,this.level2Results),this.owner.sendScript.processSend(this.level1Results,this.level2Results)}doResult(){for(;0!=this.level1Results.length;){let e=a.randomNumber(0,this.level1Results.length-1),t=this.level1Results[e];if(this.ideaResult=!1,t.func.runWith(t.param),this.ideaResult)return;this.level1Results.splice(e,1)}for(;0!=this.level2Results.length;){let e=a.randomNumber(0,this.level2Results.length-1),t=this.level2Results[e];if(this.ideaResult=!1,t.func.runWith(t.param),this.ideaResult)return;this.level2Results.splice(e,1)}this.ideaResult=!1}}class k extends Laya.Script{constructor(){super(),this.residentCreateIdList=new Set([]),this.residentUseIdList=new Set([]),this.buildingMgr=null}onEnable(){this.ani=this.owner.getChildByName("ani"),this.sliderControl=this.owner.getChildByName("sliderControl"),this.slider=this.sliderControl.getChildByName("slider"),this.sliderControl.visible=!1,this.sliderMax=this.slider.texture.width,this.buildingTouch=this.owner.getChildByName("buildingTouch"),this.initTouch()}onDisable(){}onDestroy(){this.stopTimer()}initTouch(){null!=this.buildingTouch&&null!=this.buildingTouch&&(this.buildingTouch.on(Laya.Event.MOUSE_DOWN,this,function(){this.touchDownPos=new Laya.Point(Laya.stage.mouseX,Laya.stage.mouseX)}),this.buildingTouch.on(Laya.Event.MOUSE_UP,this,function(e){this.touchDownPos&&this.touchDownPos.distance(Laya.stage.mouseX,Laya.stage.mouseX)<10&&(this.model.getBuildingState()==s.BuildingState.Noraml?this.onClickBuilding():(this.onClickBuilding(),n.getInstance().showTip("还未建造完成哦"))),this.touchDownPos=null}))}stopTimer(){Laya.timer.clear(this,this.onCreateProgress)}setBuildingMgr(e){this.buildingMgr=e}getBuildingMgr(){return this.buildingMgr}refreshByModel(e){this.model=e,this.owner.x=e.getX(),this.owner.y=e.getY();let t=this.model.getBuildingType(),i=s.BuildingDatas[String(t)];this.createAddValue=i.createBuildingSpeed/this.sliderMax,this.onInitBuilding(),this.setPreCreate()}setPreCreate(){this.ani.play(0,!0,"precreate"),this.sliderControl.visible=!0,this.slider.width=1}joinResidentIdToBuildingForCreate(e){this.residentCreateIdList.add(e)}joinResidentIdToBuildingForUse(e){this.residentUseIdList.add(e)}removeResidentIdToBuildingForUse(e){this.residentUseIdList.delete(e)}getResidentIdToBuildingForUseNum(){return this.residentUseIdList.size}startCreate(){this.model.getBuildingState()==s.BuildingState.PreCreating&&(this.model.setBuildingState(s.BuildingState.Creating),this.ani.play(0,!0,"creating"),this.sliderControl.visible=!0,this.slider.width=1,Laya.timer.loop(s.BuildingCreatingStep,this,this.onCreateProgress))}onCreateProgress(){this.slider.width=this.slider.width+this.createAddValue,this.slider.width>this.sliderMax&&(this.slider.width=this.sliderMax,this.stopTimer(),this.onCreateFinish())}onCreateFinish(){this.ani.play(0,!0,"idle"),this.sliderControl.visible=!1,Laya.timer.clear(this,this.onCreateProgress),this.model.setBuildingState(s.BuildingState.Noraml),M.setMapZOrder(this.owner),this.onCreateBuildingFinish(),S.getInstance().postEvent(m.CREATE_BUILDING_FINISH,this.makeParam(this.model)),this.residentCreateIdList.clear()}makeParam(e){let t={};return t.residentIds=this.residentCreateIdList,t.extraParam=e,t}getModel(){return this.model}onInitBuilding(){}onCreateBuildingFinish(){}onClickBuilding(){}}class E extends Laya.Script{constructor(){super(),this.buildings={}}static getInstance(){return E.instance=E.instance||new E}onEnable(){}onDisable(){}getBuildingById(e){return this.buildings[String(e)]}getBuildings(){return this.buildings}createBuildingByConfig(e){let t=L.getInstance().newBuildingModel(e),i=Laya.loader.getRes(e.prefab).create();e.parent.addChild(i);let n=i.getComponent(k);return i.buildingScript=n,n.setBuildingMgr(this),n.refreshByModel(t),this.buildings[String(t.getBuildingId())]=i,i}removeBuildingById(e){let t=this.buildings[String(e)];t&&(delete this.buildings[String(e)],t.destroy(!0),L.getInstance().removeBuildingModel(e))}canCreateBuildingForResource(e){let t=L.getInstance().getTreeNum(),i=L.getInstance().getStoneNum(),n=s.BuildingDatas[String(e)];return t>=n.costTree&&i>=n.costStone}intersectsBuilding(e,t,i,n){let s=new Laya.Rectangle(e,t,i,n);for(let e in this.buildings){let t=this.buildings[e];if(s.intersects(new Laya.Rectangle(t.x,t.y,t.width,t.height)))return!0}return!1}getAlltBuildingForCondition(e,t,i,n,s,o,r){let d=new Set(s),l=[];for(const s in this.buildings){let a=this.buildings[s],r=new Laya.Point(a.x,a.y).distance(e,t),h=a.buildingScript.getModel();if(r<=n&&d.has(h.getBuildingState())&&h.getBuildingType()==i){let e=o&&o(a);(null==o||null==o||e)&&l.push(a)}}return r?a.randomACellInArray(l):l}}class W extends Laya.Script{constructor(){super()}onEnable(){this.ani=this.owner.getChildByName("ani"),this.owner.zOrder=c.FoodZOrder,this.trigger=null}onDisable(){}onStart(){Laya.timer.once(1e3,this,this.fadeOutFinish),this.ani.play(0,!1,"fadeOut"+String(this.foodAnimIndex))}fadeOutFinish(){this.ani.play(0,!0,"idle"+String(this.foodAnimIndex)),Laya.timer.clear(this,this.fadeOutFinish)}onDestroy(){Laya.timer.clear(this,this.fadeOutFinish),this.trigger&&this.trigger.addNum(-1)}setTrigger(e){this.trigger=e}getTrigger(){return this.trigger}refreshByModel(e){this.model=e,this.owner.x=e.getX(),this.owner.y=e.getY(),this.foodType=this.model.getFoodType(),this.foodType==c.FoodTypes.FruitType?this.foodAnimIndex=Math.ceil(5*Math.random()):this.foodAnimIndex=6}getModel(){return this.model}}class H extends Laya.Script{constructor(){super(),this.foods={}}static getInstance(){return H.instance=H.instance||new H}createFoodByConfig(t){let i=Laya.loader.getRes(e.FoodPrefabPath).create();t.parent.addChild(i);let n=i.getComponent(W);i.foodScript=n,n.setTrigger(t.trigger);let s=L.getInstance().newFoodModel(t);return n.refreshByModel(s),this.foods[String(s.getFoodId())]=i,i}getRandomFood(e){let t=[];for(const i in this.foods){let n=this.foods[i];null!=e.state&&n.foodScript.getModel().getFoodState()!=e.state||new Laya.Point(n.x,n.y).distance(e.x,e.y)<=e.area&&t.push(n)}return a.randomACellInArray(t)}canFindFood(){for(const e in this.foods){if(this.foods[e].foodScript.getModel().getFoodState()==c.FoodState.CanEat)return!0}return!1}getFoodById(e){return this.foods[String(e)]}removeFoodById(e){for(const t in this.foods){let i=this.foods[t];if(i.foodScript.getModel().getFoodId()==e)return i.destroy(!0),delete this.foods[t],void L.getInstance().removeFoodModelById(e)}}}class G extends Laya.Script{constructor(){super()}onEnable(){this.curNum=0}onDisable(){this.stopTrigger()}onStart(){this.restartTrigger(c.FoodUpdateTime)}restartTrigger(e){this.stopTrigger(),this.startTrigger(e)}startTrigger(e){Laya.timer.loop(e,this,this.onCreateFood),this.onCreateFood()}stopTrigger(){Laya.timer.clear(this,this.onCreateFood)}onCreateFood(){this.createFood()}createFood(){if(this.curNum>=c.FoodMaxNumPerTrigger)return;let e=this.owner.x+a.randomNumber(0,this.owner.width),t=this.owner.y+this.owner.height-a.randomNumber(50,this.owner.height);H.getInstance().createFoodByConfig({parent:A.mapContainer,x:e,y:t,trigger:this,foodType:c.FoodTypes.FruitType}),this.addNum(1)}addNum(e){this.curNum=this.curNum+e,this.curNum>=c.FoodMaxNumPerTrigger&&(this.curNum=c.FoodMaxNumPerTrigger)}}class O extends Laya.Script{constructor(){super(),this.triggers={}}static getInstance(){return O.instance=O.instance||new O}pushFoodTrigger(e){let t=e.getComponent(G);t&&""!=t.foodTriggerKey&&(this.triggers[t.foodTriggerKey]=e)}intersectsFoodTrigger(e,t,i,n){let s=new Laya.Rectangle(e,t,i,n);for(let e in this.triggers){let t=this.triggers[e];if(s.intersects(new Laya.Rectangle(t.x,t.y,t.width,t.height)))return!0}return!1}onEnable(){}onDisable(){}}class j extends Laya.Script{constructor(){super(),this.stoneID=0}onEnable(){M.setMapZOrder(this.owner)}onDisable(){}onStart(){}setStoneID(e){this.stoneID=e}}class U extends Laya.Script{constructor(){super(),this.stones={},this.maxID=0}static getInstance(){return U.instance=U.instance||new U}pushStone(e){this.maxID++;let t=e.getComponent(j);t&&t.setStoneID(this.maxID),this.stones[String(this.maxID)]=e}getNearstStone(e,t){let i=99999999,n=null;for(let s in this.stones){let a=this.stones[s],o=new Laya.Point(a.x,a.y).distance(e,t);o<i&&(i=o,n=a)}return n}intersectsStone(e,t,i,n){let s=new Laya.Rectangle(e,t,i,n);for(let e in this.stones){let t=this.stones[e];if(s.intersects(new Laya.Rectangle(t.x,t.y,t.width,t.height)))return!0}return!1}onEnable(){}onDisable(){}}class V extends Laya.Script{constructor(){super(),this.treeID=0}onEnable(){this.ani=this.owner.getChildByName("ani"),M.setMapZOrder(this.owner)}onDisable(){}onStart(){}setTreeID(e){this.treeID=e}}class Y extends Laya.Script{constructor(){super(),this.trees={},this.maxID=0}static getInstance(){return Y.instance=Y.instance||new Y}pushTree(e){this.maxID++;let t=e.getComponent(V);t&&t.setTreeID(this.maxID),this.trees[String(this.maxID)]=e}intersectsTree(e,t,i,n){let s=new Laya.Rectangle(e,t,i,n);for(let e in this.trees){let t=this.trees[e];if(s.intersects(new Laya.Rectangle(t.x,t.y,t.width,t.height)))return!0}return!1}getRandomTree(e,t,i){let n=[];for(let s in this.trees){let a=this.trees[s];new Laya.Point(a.x,a.y).distance(e,t)<i&&n.push(a)}return a.randomACellInArray(n)}onEnable(){}onDisable(){}}class _ extends Laya.Script{constructor(){super(),this.waterID=0}setWaterID(e){this.waterID=e}onEnable(){M.setMapZOrder(this.owner,-A.mapHeight)}onDisable(){}onStart(){}}class X extends Laya.Script{constructor(){super(),this.maxID=0,this.waters={}}static getInstance(){return X.instance=X.instance||new X}pushWater(e){this.maxID++;let t=e.getComponent(_);t&&t.setWaterID(this.maxID),this.waters[String(this.maxID)]=e}randomWater(e,t,i){let n=[];for(let s in this.waters){let a=this.waters[s];new Laya.Point(a.x,a.y).distance(e,t)<i&&n.push(a)}return a.randomACellInArray(n)}intersectsWater(e,t,i,n){let s=new Laya.Rectangle(e,t,i,n);for(let e in this.waters){let t=this.waters[e];if(s.intersects(new Laya.Rectangle(t.x,t.y,t.width,t.height)))return!0}return!1}onEnable(){}onDisable(){}}class K{static isOccupySpace(e,t,i,n){return!!Y.getInstance().intersectsTree(e,t,i,n)||(!!U.getInstance().intersectsStone(e,t,i,n)||(!!E.getInstance().intersectsBuilding(e,t,i,n)||(!!X.getInstance().intersectsWater(e,t,i,n)||!!O.getInstance().intersectsFoodTrigger(e,t,i,n))))}static getAIGoToCreateBuildingInfo(e,t){let i=E.getInstance().getBuildings(),n=new Set([s.BuildingState.PreCreating,s.BuildingState.Creating]),o=function(e){for(const t in r.ResidentContinueCreateMap){let i=r.ResidentContinueCreateMap[t];if(i.isContinueCreate&&e==i.buildingType)return t}return null},d=[];for(const a in i){let r=i[a],l=new Laya.Point(r.x,r.y).distance(e,t),h=r.buildingScript.getModel(),g=h.getBuildingType(),c=o(g);l<=1e3&&n.has(h.getBuildingState())&&c&&d.push({building:r,state:c,meta:s.BuildingDatas[g]})}return 0==d.length?null:d[a.randomNumber(0,d.length-1)]}}class J extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.model=this.owner.residentLogicScript.getModel()}getModel(){return this.model}processCreateBuilding(e,t){if(this.getModel().isAdult()){let i=K.getAIGoToCreateBuildingInfo(this.owner.x,this.owner.y),n={func:Laya.Handler.create(this,function(){i&&(this.owner.residentLogicScript.refreshFSMState(i.state,i.building),this.owner.AILogicScript.ideaResult=!0)})};i&&(i.meta&&1==i.meta.createPriority?e.push(n):t.push(n))}}canGotoCreateBuilding(e){let t=r.ResidentContinueCreateMap[String(e)];return t?t.nextState:null}canStartCreateBuilding(e){for(const t in r.ResidentContinueCreateMap){let i=r.ResidentContinueCreateMap[t];if(i&&i.nextState==e&&null!=e&&null!=e)return!0}return!1}canFinishCreateBuilding(e){for(const t in r.ResidentContinueCreateMap){let i=r.ResidentContinueCreateMap[t];if(i&&i.nextState==e&&null!=e&&null!=e)return!0;if(Number(t)==e&&null!=e&&null!=e)return!0}return!1}startGotoContinueCreateBuilding(e){S.getInstance().registEvent(m.CREATE_BUILDING_FINISH,this.owner.residentLogicScript,this.owner.residentLogicScript.onDoWorkFinish),this.continueCreateBuilding=e.building;let t=e.nextState;this.continueCreateBuilding.buildingScript.joinResidentIdToBuildingForCreate(this.getModel().getResidentId()),this.owner.residentLogicScript.walkTo({x:this.continueCreateBuilding.x+this.continueCreateBuilding.width/2-this.owner.width/2,y:this.continueCreateBuilding.y+this.continueCreateBuilding.height-this.owner.height+r.ResidentGotoYOff},Laya.Handler.create(this,function(){this.owner.residentLogicScript.refreshFSMState(t,this.continueCreateBuilding)}))}startCreateBuilding(){this.continueCreateBuilding&&(this.owner.residentLogicScript.setAnim(r.ResidentAnim.Work),this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani2"),this.continueCreateBuilding.buildingScript.startCreate())}clearContinueCreateBuilding(){S.getInstance().removeEvent(m.CREATE_BUILDING_FINISH,this.owner.residentLogicScript,this.owner.residentLogicScript.onDoWorkFinish),this.continueCreateBuilding=null}}class Z extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){Laya.timer.clear(this,this.onCollectSendFinish),Laya.timer.clear(this,this.onPutDownSend)}onStart(){this.model=this.owner.residentLogicScript.getModel()}getModel(){return this.model}processSend(e,t){for(const e in r.ResidentSendAIMap)if(this.canReachSendCondition(e)){let i={func:Laya.Handler.create(this,function(){let t=this.getSendAndDest(e);t&&t.send&&t.dest&&(this.preSend(e,t),this.owner.residentLogicScript.refreshFSMState(e,t),this.owner.AILogicScript.ideaResult=!0)})};t.push(i)}}canSendExt(e){return r.ResidentSendAIMap[e]}gotoFindSend(e){let t=e.sendAIMeta,i=e.sendInfo,n=t.collectState;this.owner.residentLogicScript.walkTo({x:i.send.x+i.send.width/2-this.owner.width/2,y:i.send.y+i.send.height-this.owner.height+r.ResidentGotoYOff},Laya.Handler.create(this,function(){this.owner.residentLogicScript.refreshFSMState(n,e)}))}canCollect(e){for(const t in r.ResidentSendAIMap){if(e==r.ResidentSendAIMap[t].collectState&&null!=e&&null!=e)return!0}return!1}canSendToDest(e){for(const t in r.ResidentSendAIMap){if(e==r.ResidentSendAIMap[t].lastState&&null!=e&&null!=e)return!0}return!1}canSendFinish(e){for(const t in r.ResidentSendAIMap){if(e==r.ResidentSendAIMap[t].lastState&&null!=e&&null!=e)return!0}return!1}colletSend(e){this.owner.residentLogicScript.setAnim(r.ResidentAnim.Work),this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani9"),Laya.timer.once(r.ResidentCollectSendTime*this.getModel().getFarmScale(),this,this.onCollectSendFinish,[e])}onCollectSendFinish(e){let t=e.sendAIMeta;this.onGetAddValueInfo(e),this.owner.residentLogicScript.refreshFSMState(t.lastState,e)}gotoSendToDest(e){this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani10");let t=e.sendInfo;this.owner.residentLogicScript.walkTo({x:t.dest.x+t.dest.width/2-this.owner.width/2,y:t.dest.y+t.dest.height-this.owner.height+r.ResidentGotoYOff},Laya.Handler.create(this,function(){this.onPutDownSend(e)}))}onPutDownSend(e){this.owner.visible=!1,Laya.timer.once(1e3,this,function(){this.owner.visible=!0,this.owner.residentLogicScript.onDoWorkFinish(this.owner.residentLogicScript.makeParam(e))})}onGetAddValueInfo(e){let t=e.sendInfo,i=this.getModel().getFSMState();if(i==r.ResidentState.CollectFood){if(2==t.sendType){let i=t.send.foodScript.getModel(),n=i.getFood();H.getInstance().removeFoodById(i.getFoodId()),t.send=null,e.addFood=n}else if(1==t.sendType){let i=s.BuildingDatas[s.BuildingType.FarmLandType],n=t.send.buildingScript,a=n.getCurSaveFood(),o=Math.min(a,i.addFood);n.addFoodToPool(-o),t.send=null,e.addFood=o}else if(3==t.sendType){let i=s.BuildingDatas[s.BuildingType.PastureType],n=t.send.buildingScript,a=n.getCurSaveFood(),o=Math.min(a,i.addFood);n.addFoodToPool(-o),t.send=null,e.addFood=o}}else i==r.ResidentState.CollectWater&&(e.addWater=r.ResidentSaveWaterAddValue)}onFinishSend(e){let t=e.extraParam,i=t.sendInfo.dest,n=this.getModel().getFSMState();n==r.ResidentState.SendFoodToFoodPool?i.buildingScript.addFoodToPool(t.addFood):n==r.ResidentState.SendWaterToWaterPool&&i.buildingScript.addWaterToPool(t.addWater)}canReachSendCondition(e){return e==r.ResidentState.FindFoodForSend?!!this.getModel().isAdult():e==r.ResidentState.FindWaterForSend?!!this.getModel().isAdult():void 0}getSendAndDest(e){if(e==r.ResidentState.FindFoodForSend){let t=0,i=null,n=function(e){return e.buildingScript.getCurSaveFood()>20},o=E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,s.BuildingType.FarmLandType,2e3,[s.BuildingState.Noraml],n,!0),r=E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,s.BuildingType.PastureType,2e3,[s.BuildingState.Noraml],n,!0),d=H.getInstance().getRandomFood({x:this.owner.x,y:this.owner.y,state:c.FoodState.CanEat,area:2e3});o||r?o&&!r?(t=1,i=o):r&&!o?(t=3,i=r):a.randomYes()?(t=1,i=o):(t=3,i=r):d&&(t=2,i=d);let l=function(e){return!e.buildingScript.isReachFoodMax()},h=E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,s.BuildingType.FoodPoolType,2e3,[s.BuildingState.Noraml],l,!0);return h?{AIType:e,send:i,dest:h,sendType:t}:null}if(e==r.ResidentState.FindWaterForSend){let t=X.getInstance().randomWater(this.owner.x,this.owner.y,2e3),i=function(e){return!e.buildingScript.isReachWaterMax()},n=E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,s.BuildingType.WaterPoolType,2e3,[s.BuildingState.Noraml],i,!0);return n?{AIType:e,send:t,dest:n}:null}}preSend(e,t){e==r.ResidentState.FindFoodForSend&&2==t.sendType&&t.send.foodScript.getModel().setFoodState(c.FoodState.Occupy)}}class z extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}refreshInfo(e){this.owner.getChildByName("name").text=e.residentName;let t="男";2==e.sex&&(t="女"),this.owner.getChildByName("sex").text="性别: "+t;let i="未婚";2==e.married&&(i="已婚"),this.owner.getChildByName("married").text=i,this.owner.getChildByName("temperature").text="体温: "+String(e.temperature),this.owner.getChildByName("age").text="年龄: "+String(e.age),this.setSlider("sliderLife",e.life),this.setSlider("sliderWater",e.water),this.setSlider("sliderFood",e.food),this.setSlider("sliderEnjoy",e.enjoy),this.setSlider("sliderTeach",e.teach),this.setSlider("sliderSocial",e.social)}setSlider(e,t){let i=this.owner.getChildByName(e).getChildByName("slider"),n=t/100,s=Math.ceil(194*n)/194;i.scaleY=s}}class q extends Laya.Script{constructor(){super(),this.curPanel=null}onEnable(){}onDisable(){}static getInstance(){return q.instance=q.instance||new q}showPanel(t){this.removePanel();let i=Laya.loader.getRes(e.ResdientDetailsPanelPath);this.curPanel=i.create(),this.curPanel.x=65,this.curPanel.y=15-this.curPanel.height,t.parent.addChild(this.curPanel),this.curPanel.getComponent(z).refreshInfo(t.data),this.curPanel.alpha=0,Laya.Tween.to(this.curPanel,{alpha:1},200),Laya.timer.once(3e3,this,this.fadeOutFunc)}fadeOutFunc(){Laya.Tween.to(this.curPanel,{alpha:0},200,null,Laya.Handler.create(this,function(){this.removePanel()}))}removePanel(){this.curPanel&&(Laya.timer.clear(this,this.fadeOutFunc),this.curPanel.removeSelf(),this.curPanel.destroy(!0),this.curPanel=null)}}class Q extends Laya.Script{constructor(){super()}onDestroy(){this.trigger&&this.trigger.addNum(-1),H.getInstance().createFoodByConfig({parent:A.mapContainer,x:this.owner.x+this.owner.width/2,y:this.owner.y+this.owner.height/2,foodType:c.FoodTypes.MeatType})}onEnable(){this.trigger=null,this.root=this.owner.getChildByName("root"),this.ani=this.root.getChildByName("ani")}onDisable(){Laya.timer.clear(this,this.onWalkFinish),Laya.timer.clear(this,this.onHurtFinish)}onStart(){this.owner.alpha=0,Laya.Tween.to(this.owner,{alpha:1},1e3,Laya.Ease.circIn),this.setIdle(),this.setWalk()}joinHunt(e){this.model.addHuntResidentIds(e)}setIdle(){this.model.getState()!=d.AnimalState.Idle&&(this.tweenObject&&(Laya.Tween.clear(this.tweenObject),this.tweenObject=null),this.model.setState(d.AnimalState.Idle),this.ani.play(0,!0,"idle1"))}setWalk(){this.onWalkFinish(),Laya.timer.loop(3e3,this,this.onWalkFinish)}pauseWalk(){this.setIdle(),Laya.timer.clear(this,this.onWalkFinish)}setHurt(){this.model.getState()!=d.AnimalState.Hurt&&(Laya.timer.once(d.AnimalHurtTime,this,this.onHurtFinish),Laya.timer.clear(this,this.onWalkFinish),this.tweenObject&&(Laya.Tween.clear(this.tweenObject),this.tweenObject=null),this.model.setState(d.AnimalState.Hurt),this.ani.play(0,!0,"hurt1"))}makeParam(e){let t={};return t.residentIds=this.model.getHuntResidentIds(),t.extraParam=e,t}onHurtFinish(){Laya.timer.clear(this,this.onHurtFinish),S.getInstance().postEvent(m.HUNT_FINISH,this.makeParam(this.owner)),this.model.clearHuntResidentIds()}onWalkFinish(){if(this.model.getState()==d.AnimalState.Walk)return;this.model.setState(d.AnimalState.Walk),this.ani.play(0,!0,"walk1");let e=a.randomByArea(this.trigger.owner.x,this.trigger.owner.y,150);this.gotoDest({x:e.x,y:e.y},Laya.Handler.create(this,function(){this.setIdle()}))}setTrigger(e){this.trigger=e}getTrigger(){return this.trigger}refreshByModel(e){this.model=e,this.owner.x=e.getX(),this.owner.y=e.getY()}getModel(){return this.model}gotoDest(e,t){this.tweenObject&&(Laya.Tween.clear(this.tweenObject),this.tweenObject=null);let i=e.x,n=e.y,s=M.getSign(i-this.owner.x);this.root.scaleX=s*Math.abs(this.root.scaleX);let a=new Laya.Point(i,n).distance(this.owner.x,this.owner.y)/d.AnimalMoveSpeed;this.tweenObject=Laya.Tween.to(this.owner,{x:i,y:n},1e3*a,null,t)}}class $ extends Laya.Script{constructor(){super(),this.animals={}}onEnable(){}onDisable(){Laya.timer.clear(this,this.onUpdateFunc)}static getInstance(){return $.instance?$.instance:($.instance=new $,$.instance.initSelf(),$.instance)}initSelf(){Laya.timer.loop(1e3,this,this.onUpdateFunc)}onUpdateFunc(){for(let e in this.animals){let t=this.animals[e];M.setMapZOrder(t)}}removeAnimalById(e){let t=this.animals[String(e)];t&&(t.destroy(!0),delete this.animals[String(e)],L.getInstance().removeAnimalModel(e))}createAnimalByConfig(t){let i=Laya.loader.getRes(e.AnimalPrefabPath).create();t.parent.addChild(i);let n=i.getComponent(Q);n.setTrigger(t.trigger);let s=L.getInstance().newAnimalModel(t);n.refreshByModel(s),this.animals[String(s.getAnimalId())]=i}getAnimalForAttack(e,t,i){for(const n in this.animals){let s=this.animals[n],a=s.getComponent(Q).getModel();if(new Laya.Point(s.x,s.y).distance(e,t)<=i&&a.getAttackNum()<a.getAttackMaxNum()&&a.getState()!=d.AnimalState.Die)return s}return null}}class ee extends Laya.Script{constructor(){super()}onEnable(){this.ani=this.owner.getChildByName("ani")}onDisable(){}onStart(){this.moveLogic=this.owner.getComponent(D),this.initMoveLogic(),this.ani.play(0,!0,"idle")}initMoveLogic(){let e=this;this.leftFunc=function(){e.ani.play(0,!0,"walk_left")},this.rightFunc=function(){e.ani.play(0,!0,"walk_right")},this.upFunc=function(){e.ani.play(0,!0,"walk_up")},this.downFunc=function(){e.ani.play(0,!0,"walk_down")},this.moveLogic.setCallbackFunc({leftFunc:this.leftFunc,rightFunc:this.rightFunc,upFunc:this.upFunc,downFunc:this.downFunc})}walkTo(e,t){this.moveLogic.gotoDest(e,Laya.Handler.create(this,function(){this.ani.play(0,!0,"idle"),t&&t.run()}))}}class te extends Laya.Script{constructor(){super()}onStart(){this.initMoveLogic()}onEnable(){this.rigsterAllEvents(),this.initModel(),this.initControl(),this.initTouch()}onDisable(){this.removeAllEvents(),this.removeAllTimers()}onDestroy(){}initMoveLogic(){let e=this;this.leftFunc=function(){e.ani.play(0,!0,"walk_left")},this.rightFunc=function(){e.ani.play(0,!0,"walk_right")},this.upFunc=function(){e.ani.play(0,!0,"walk_up")},this.downFunc=function(){e.ani.play(0,!0,"walk_down")},this.getMoveScript().setCallbackFunc({leftFunc:this.leftFunc,rightFunc:this.rightFunc,upFunc:this.upFunc,downFunc:this.downFunc})}removeAllTimers(){Laya.timer.clear(this,this.onDoWorkFinish),Laya.timer.clear(this,this.hideTip)}rigsterAllEvents(){S.getInstance().registEvent(m.RESIDENT_SICK,this,this.onSick),S.getInstance().registEvent(m.RESIDENT_DIE,this,this.onDie),S.getInstance().registEvent(m.RESIDENT_GROWUP,this,this.onGrowUp)}removeAllEvents(){S.getInstance().removeEvent(m.RESIDENT_SICK,this,this.onSick),S.getInstance().removeEvent(m.RESIDENT_DIE,this,this.onDie),S.getInstance().removeEvent(m.RESIDENT_GROWUP,this,this.onGrowUp)}initControl(){this.initAnim(),this.stateAni=this.owner.getChildByName("stateAni"),this.buffAni=this.owner.getChildByName("buff"),this.tipSpr=this.owner.getChildByName("tipSpr"),this.boredTip=this.tipSpr.getChildByName("text"),this.hideTip(),this.setStateAniVisible(!1),this.setBuffAniVisible(!1)}initAnim(){this.manAni=this.owner.getChildByName("manAni"),this.womanAni=this.owner.getChildByName("womanAni"),this.babyAni=this.owner.getChildByName("babyAni"),this.manAni.stop(),this.womanAni.stop(),this.babyAni.stop(),this.manAni.visible=!1,this.womanAni.visible=!1,this.babyAni.visible=!1}onGrowUp(e){this.model.getResidentId()==e.getResidentId()&&this.growup()}onDie(e){this.model.getResidentId()==e.getResidentId()&&this.refreshFSMState(r.ResidentState.Die)}onSick(e){if(this.model.getResidentId()!=e.getResidentId())return;2==e.getSick()?(this.setBuffAni("sickAni"),this.setBuffAniVisible(!0)):(this.stopBuffAni(),this.setBuffAniVisible(!1))}hideTip(){this.tipTweenObject&&(Laya.Tween.clear(this.tipTweenObject),this.tipTweenObject=null),Laya.timer.clear(this,this.hideTip),this.tipSpr.scaleX=0,this.tipSpr.scaleY=0,this.tipSpr.visible=!1,this.boredTip.text=""}showTip(e,t){null!=t&&null!=t||(t=!1),this.tipTweenObject&&0==t||(this.hideTip(),this.boredTip.text=e,this.tipSpr.visible=!0,this.tipTweenObject=Laya.Tween.to(this.tipSpr,{scaleX:1,scaleY:1},200,Laya.Ease.backIn,Laya.Handler.create(this,function(){})),Laya.timer.once(3e3,this,this.hideTip))}setBuffAni(e){this.buffAni.play(0,!0,e)}setBuffAniVisible(e){this.buffAni.visible=e}stopBuffAni(){this.buffAni.stop()}setStateAni(e){this.stateAni.play(0,!0,e)}setStateAniVisible(e){this.stateAni.visible=e}stopStateAni(){this.stateAni.stop()}initModel(){this.findCreateBuildingTimes=0,this.curStateAnim=r.ResidentAnim.Null}initTouch(){this.owner.on(Laya.Event.CLICK,this,function(){q.getInstance().showPanel({data:this.model,parent:this.owner})})}setResidentMgrInstance(e){this.residentMgrInstance=e}refreshByModel(e){this.model=e,this.owner.x=this.model.getX(),this.owner.y=this.model.getY(),this.model.isAdult()?1==this.model.getSex()?(this.ani=this.manAni,this.womanAni.destroy(!0),this.womanAni=null):(this.ani=this.womanAni,this.manAni.destroy(!0),this.manAni=null):(this.ani=this.babyAni,1==this.model.getSex()?(this.womanAni.destroy(!0),this.womanAni=null):(this.manAni.destroy(!0),this.manAni=null)),this.ani.visible=!0,this.refreshFSMState(r.ResidentState.IdleState)}getModel(){return this.model}growup(){let e=this.curStateAnim,t=this.curStateAnimLoop,i=this.ani.visible;this.curStateAnim="",this.babyAni.destroy(!0),this.babyAni=null,1==this.model.getSex()?this.ani=this.manAni:2==this.model.getSex()&&(this.ani=this.womanAni),this.ani.visible=i,this.setAnim(e,t)}setAnim(e,t,i){this.curStateAnim!=e&&(null!=t&&null!=t||(t=!0),e==r.ResidentAnim.Idle?this.ani.play(0,t,"idle"):e==r.ResidentAnim.Walk||(e==r.ResidentAnim.Enjoy?this.ani.play(0,t,"enjoy"):e==r.ResidentAnim.Work?this.ani.play(0,t,"work"):e==r.ResidentAnim.Die?this.ani.play(0,t,"die"):e==r.ResidentAnim.Anger&&("right"==i?this.ani.play(0,t,"anger_right"):this.ani.play(0,t,"anger_left"))),this.curStateAnim=e,this.curStateAnimLoop=t)}stopAni(){this.curStateAnim=null,this.ani.stop()}setVisible(e){this.owner.visible=e}getMoveScript(){return this.owner.residentMoveLogicScript}refreshFSMState(e,t){let i=this.model.getFSMState();if(i==e)return;if(i==r.ResidentState.Die)return;this.model.setFSMState(e),this.setStateAniVisible(!1),this.setVisible(!0),this.stopStateAni(),this.stopAni(),this.getMoveScript().stopGoto(),Laya.timer.clear(this,this.onDoWorkFinish);let n=this.owner.createBuildingScript.canGotoCreateBuilding(e),s=this.owner.useBuildingScript.canGotoUseBuilding(e),a=this.owner.sendScript.canSendExt(e),o=this.owner.sendScript.canCollect(e),d=this.owner.sendScript.canSendToDest(e),l=this.owner.findBlockForCreateScript.canFindCreateBuildingBlock(e),h=this.owner.useBuildingScript.canStartUseBuilding(e),g=this.owner.doSomeThingScript.canGotoTargetExt(e),c=this.owner.doSomeThingScript.canDoSomeThingExt(e);g?this.owner.doSomeThingScript.gotoTargetForDoSomeThing(e,t):c?this.owner.doSomeThingScript.doSomeThing(e,t):n?this.owner.createBuildingScript.startGotoContinueCreateBuilding({building:t,nextState:n}):s?this.owner.useBuildingScript.startGotoBuildingForUse({building:t,nextState:s.nextState}):this.owner.createBuildingScript.canStartCreateBuilding(e)?this.owner.createBuildingScript.startCreateBuilding():h?this.owner.useBuildingScript.startUseBuilding(h):a?this.owner.sendScript.gotoFindSend({sendAIMeta:a,sendInfo:t}):o?this.owner.sendScript.colletSend(t):d?this.owner.sendScript.gotoSendToDest(t):e==r.ResidentState.IdleState?this.setAnim(r.ResidentAnim.Idle):l?(this.owner.findBlockForCreateScript.findCreateBuildingTimes=0,this.owner.findBlockForCreateScript.startFindCreateBuildingBlock(t)):e==r.ResidentState.LoverMan?this.owner.lookForLoverScript.startFindWoman():e==r.ResidentState.LoverWoman?this.owner.lookForLoverScript.onWomanWaitMan():e==r.ResidentState.LoverGoHomeMakeLove?this.owner.lookForLoverScript.startGoHomeAndWoman():e==r.ResidentState.LoverMakeLove?this.owner.lookForLoverScript.startMakelove():e==r.ResidentState.JoinTalking?this.owner.socialScript.startJoinTalkingPoint(t):e==r.ResidentState.TalkingAbout?this.owner.socialScript.onTalkingAbout(t):e==r.ResidentState.JoinFight?this.owner.fightScript.startJoinFightPoint(t):e==r.ResidentState.Fighting?this.owner.fightScript.onFight(t):e==r.ResidentState.JoinHunt?this.owner.huntScript.startJoinHunt(t):e==r.ResidentState.Hunting?this.owner.huntScript.onHunting():e==r.ResidentState.Die?(this.setBuffAniVisible(!1),this.setStateAniVisible(!1),this.setAnim(r.ResidentAnim.Die,!1),Laya.timer.once(r.DieTime,this,this.onDoWorkFinish,[this.makeParam(null)])):e==r.ResidentState.RandomWalk&&this.owner.randomWalkScript.startGotoRandomPoint(t)}doWorkFinishClearFunc(){Laya.timer.clear(this,this.onDoWorkFinish),this.refreshFSMState(r.ResidentState.IdleState)}onDoWorkFinish(e){if(!e.residentIds.has(this.getModel().getResidentId()))return;let t=this.model.getFSMState();if(this.owner.createBuildingScript.canFinishCreateBuilding(t))this.owner.createBuildingScript.clearContinueCreateBuilding();else if(this.owner.useBuildingScript.canFinishUseBuilding(t))this.owner.useBuildingScript.onFinishUseBuilding(t),this.owner.useBuildingScript.clearUseBuilding();else if(this.owner.sendScript.canSendFinish(t))this.owner.sendScript.onFinishSend(e);else if(this.owner.doSomeThingScript.canDoSomeThingExt(t))this.owner.doSomeThingScript.onFinishDoSomeThing(t);else if(t==r.ResidentState.TalkingAbout)this.owner.socialScript.onTalkingAboutFinished(e);else if(t==r.ResidentState.Fighting)this.owner.fightScript.onFightFinished(e);else if(t==r.ResidentState.JoinHunt||t==r.ResidentState.Hunting)this.owner.huntScript.onHuntFinished();else{if(t==r.ResidentState.Die)return E.getInstance().removeBuildingById(this.model.getMyHomeId()),void this.residentMgrInstance.removeResidentById(this.model.getResidentId());t==r.ResidentState.CreateHome&&this.clearContinueCreateBuilding()}this.doWorkFinishClearFunc()}walkTo(e,t){if(this.owner.residentLogicScript.setAnim(r.ResidentAnim.Walk),e.speed=this.getModel().getSpeedScale()*r.ResidentMoveSpeed,this.getMoveScript().gotoDest(e,t),this.getPet()){let t={x:e.x+60,y:e.y-40,forceFirstY:e.isFirstY};Laya.timer.once(1e3,this,function(){this.getPetScript().walkTo(t)})}}makeParam(e){let t={};return t.residentIds=new Set([this.model.getResidentId()]),t.extraParam=e,t}addPetByPetType(t){let i=Laya.loader.getRes(e.PetPrefabPath).create();i.petScript=i.getComponent(ee),this.pet=i,this.owner.parent.addChild(this.pet),this.pet.x=this.owner.x+this.owner.width,this.pet.y=this.owner.y+20}getPet(){return this.pet}getPetScript(){return this.getPet().petScript}}class ie extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.model=this.owner.residentLogicScript.getModel()}getModel(){return this.model}canReachDoSomeThingCondition(e,t){if(e==r.ResidentState.FindFood){this.doSomeThingAIPriority=2;let e=this.getModel().getFood();return e<r.ResidentFoodNeedValue?(this.doSomeThingAIPriority=1,!0):e<30}if(e==r.ResidentState.FindWater){this.doSomeThingAIPriority=2;let e=this.getModel().getWater();return e<r.ResidentWaterNeedValue?(this.doSomeThingAIPriority=1,!0):e<30}return e==r.ResidentState.FindTree?(this.doSomeThingAIPriority=2,!(!a.randomYes()||!this.getModel().isAdult())):e==r.ResidentState.FindStone?(this.doSomeThingAIPriority=2,!(!a.randomYes()||!this.getModel().isAdult())):void 0}getGotoTargetInfo(e,t){if(e==r.ResidentState.FindFood){let i=H.getInstance().getRandomFood({x:this.owner.x,y:this.owner.y,state:c.FoodState.CanEat,area:2e3});return i?{AIType:e,AIData:t,target:i,desX:i.x,desY:i.y}:null}if(e==r.ResidentState.FindWater){let i=X.getInstance().randomWater(this.owner.x,this.owner.y,2e3);if(!i)return null;let n=a.randomPointInRect(i.x,i.y,i.width,i.height);return{AIType:e,AIData:t,target:i,desX:n.x,desY:n.y}}if(e==r.ResidentState.FindTree){let i=Y.getInstance().getRandomTree(this.owner.x,this.owner.y,2e3);return i?{AIType:e,AIData:t,target:i,desX:i.x+i.width/2-this.owner.width/2,desY:i.y+i.height-this.owner.height+20}:null}if(e==r.ResidentState.FindStone){let i=U.getInstance().getNearstStone(this.owner.x,this.owner.y);return i?{AIType:e,AIData:t,target:i,desX:i.x+i.width/2-this.owner.width/2,desY:i.y+i.height-this.owner.height+20}:null}}preGotoTarget(e){if(e.AIType==r.ResidentState.FindFood){e.target.foodScript.getModel().setFoodState(c.FoodState.Occupy)}else e.AIType==r.ResidentState.FindWater||e.AIType==r.ResidentState.FindTree||(e.AIType,r.ResidentState.FindStone)}doSomeThing(e,t){if(e==r.ResidentState.EatFood){this.curTargetInfo=t;let e=this.curTargetInfo.target.foodScript.getModel();e.setFoodState(c.FoodState.Eating),this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setAnim(r.ResidentAnim.Work),this.owner.residentLogicScript.setStateAni("ani3"),Laya.timer.once(e.getEatCDTime(),this.owner.residentLogicScript,this.owner.residentLogicScript.onDoWorkFinish,[this.owner.residentLogicScript.makeParam(null)])}else e==r.ResidentState.DrinkWater?(this.owner.residentLogicScript.setAnim(r.ResidentAnim.Work),this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani4"),Laya.timer.once(c.DrinkWaterTime,this.owner.residentLogicScript,this.owner.residentLogicScript.onDoWorkFinish,[this.owner.residentLogicScript.makeParam(null)])):e==r.ResidentState.CutDownTree?(this.owner.residentLogicScript.setAnim(r.ResidentAnim.Work),this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani1"),Laya.timer.once(r.CutDownTreeTime*this.getModel().getCollectionSpeedScale(),this.owner.residentLogicScript,this.owner.residentLogicScript.onDoWorkFinish,[this.owner.residentLogicScript.makeParam(null)])):e==r.ResidentState.CollectStone&&(this.owner.residentLogicScript.setAnim(r.ResidentAnim.Work),this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani2"),Laya.timer.once(r.CollectStoneTime*this.getModel().getCollectionSpeedScale(),this.owner.residentLogicScript,this.owner.residentLogicScript.onDoWorkFinish,[this.owner.residentLogicScript.makeParam(null)]))}onFinishDoSomeThing(e){if(e==r.ResidentState.EatFood){let e=this.curTargetInfo.target.foodScript.getModel();this.getModel().addFood(e.getFood()),H.getInstance().removeFoodById(e.getFoodId()),this.curTargetInfo=null}else e==r.ResidentState.DrinkWater?this.getModel().addWater(r.ResidentDrinkWaterAddValue):e==r.ResidentState.CutDownTree?L.getInstance().addTreeNum(r.ResidentAddTreeBaseValue):e==r.ResidentState.CollectStone&&L.getInstance().addStoneNum(r.ResidentAddStoneBaseValue)}canGotoTargetExt(e){for(const t in r.ResidentGOtoSomeWhereDoSomeThingAIMap){r.ResidentGOtoSomeWhereDoSomeThingAIMap[t];if(e==t)return!0}return!1}gotoTargetForDoSomeThing(e,t){this.owner.residentLogicScript.setAnim(r.ResidentAnim.Walk),this.owner.residentLogicScript.walkTo({x:t.desX,y:t.desY},Laya.Handler.create(this,function(){this.owner.residentLogicScript.refreshFSMState(t.AIData.nextState,t)}))}canDoSomeThingExt(e){for(const t in r.ResidentGOtoSomeWhereDoSomeThingAIMap){if(e==r.ResidentGOtoSomeWhereDoSomeThingAIMap[t].nextState&&null!=e&&null!=e)return!0}return!1}processDoSomeThing(e,t){for(const i in r.ResidentGOtoSomeWhereDoSomeThingAIMap){let n=r.ResidentGOtoSomeWhereDoSomeThingAIMap[i];if(this.doSomeThingAIPriority=2,this.canReachDoSomeThingCondition(i,n)){let s={func:Laya.Handler.create(this,function(){let e=this.getGotoTargetInfo(i,n);e&&e.target?(this.owner.AILogicScript.ideaResult=!0,this.preGotoTarget(e),this.owner.residentLogicScript.refreshFSMState(i,e)):(this.owner.AILogicScript.ideaResult=!1,this.owner.residentLogicScript.refreshFSMState(r.ResidentState.IdleState))})};1==this.doSomeThingAIPriority?e.push(s):t.push(s)}}}}class ne extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.model=this.owner.residentLogicScript.getModel()}getModel(){return this.model}processRandomWalk(e,t){let i={func:Laya.Handler.create(this,function(){let e=a.randomByArea(this.owner.x,this.owner.y,200);K.isOccupySpace(this.owner.x,this.owner.y,this.owner.width,this.owner.height)||(this.owner.residentLogicScript.refreshFSMState(r.ResidentState.RandomWalk,e),this.owner.AILogicScript.ideaResult=!0)})};t.push(i)}startGotoRandomPoint(e){this.owner.residentLogicScript.walkTo({x:e.x,y:e.y},Laya.Handler.create(this,function(){this.owner.residentLogicScript.refreshFSMState(r.ResidentState.IdleState)}))}}class se extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.model=this.owner.residentLogicScript.getModel()}getModel(){return this.model}processResidentFindCreateBuildingBlockAI(e,t){for(const i in r.ResidentFindCreateBuildingBlockAIMap){this.findBlockAIPriority=2;let n=r.ResidentFindCreateBuildingBlockAIMap[i];if(this.canFindCreateBuildingBlockCondition(i,n)){let s={func:Laya.Handler.create(this,function(){this.owner.residentLogicScript.refreshFSMState(i,n),this.owner.AILogicScript.ideaResult=!0})};2==this.findBlockAIPriority?t.push(s):e.push(s)}}}canFindCreateBuildingBlockCondition(e,t){if(e==r.ResidentState.FindBlockForCreateHome)return this.findBlockAIPriority=1,a.randomYes()&&0==this.getModel().getMyHomeId()&&1==this.getModel().getSex()&&this.getModel().isAdult()&&E.getInstance().canCreateBuildingForResource(s.BuildingType.HomeType);if(e==r.ResidentState.FindBlockForCreateFire){if(!this.getModel().isAdult())return!1;if(!E.getInstance().canCreateBuildingForResource(s.BuildingType.FireType))return!1;if(this.getModel().getTemperature()>r.ResidentStandardTemperature-1)return!1;return this.findBlockAIPriority=1,!E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,s.BuildingType.FireType,1e3,[s.BuildingState.Noraml],null,!0)}}onFindBlockForCreateBuilding(e,t){let i=this.getModel().getFSMState();i==r.ResidentState.FindBlockForCreateHome?this.model.setMyHomeId(e.buildingScript.getModel().getBuildingId()):r.ResidentState.FindBlockForCreateFire}canFindCreateBuildingBlock(e){return r.ResidentFindCreateBuildingBlockAIMap[e]}startFindCreateBuildingBlock(e){if(this.findCreateBuildingTimes<r.ResidentFindPathTimes){let t=a.randomByArea2(this.owner.x,this.owner.y,300,A.mapWidth,A.mapHeight,o.MapSideOff,o.MapSideOff);this.owner.residentLogicScript.walkTo({x:t.x,y:t.y},Laya.Handler.create(this,function(){this.findCreateBuildingTimes++;let t=s.BuildingDatas[e.buildingType],i=this.owner.x-t.width/2+this.owner.width/2,n=this.owner.y-t.height+this.owner.height;if(K.isOccupySpace(i,n,t.width,t.height))this.startFindCreateBuildingBlock(e);else{let s=E.getInstance().createBuildingByConfig({parent:A.mapContainer,x:i,y:n,prefab:t.prefab,buildingType:e.buildingType});this.onFindBlockForCreateBuilding(s,e),this.owner.residentLogicScript.refreshFSMState(e.nextState,s)}}))}else this.owner.residentLogicScript.refreshFSMState(r.ResidentState.IdleState),this.findCreateBuildingTimes=0}}class ae extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.model=this.owner.residentLogicScript.getModel()}getModel(){return this.model}processSocial(e,t){let i={func:Laya.Handler.create(this,function(e){let t=this.owner.residentLogicScript.residentMgrInstance.getACanSocialResident(this.owner);if(t){let e=L.getInstance().getOrCreateTalkingPoint(this.owner.x,this.owner.y,40,5);0==e.getTalkingNum()?(e.addTalkingNum(2),this.owner.residentLogicScript.refreshFSMState(r.ResidentState.JoinTalking,e),t.residentLogicScript.refreshFSMState(r.ResidentState.JoinTalking,e)):(e.addTalkingNum(1),this.owner.residentLogicScript.refreshFSMState(r.ResidentState.JoinTalking,e)),this.owner.AILogicScript.ideaResult=!0}})},n=this.getModel().getSocial();n<r.ResidentSocialNeedValue?e.push(i):a.randomYes()&&n<100&&t.push(i)}startJoinTalkingPoint(e){let t=e.getTalkingPosInArea();this.owner.residentLogicScript.walkTo({x:t.x,y:t.y},Laya.Handler.create(this,function(){this.owner.residentLogicScript.refreshFSMState(r.ResidentState.TalkingAbout,e)}))}onTalkingAbout(e){this.owner.residentLogicScript.setAnim(r.ResidentAnim.Enjoy),this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani6"),Laya.timer.once(10*r.SocialTimeStep,this.owner.residentLogicScript,this.owner.residentLogicScript.onDoWorkFinish,[this.owner.residentLogicScript.makeParam(e)])}onTalkingAboutFinished(e){let t=e.extraParam;t.addTalkingNum(-1),this.model.addSocial(r.ResidentAddSocialBaseValue),0==t.getTalkingNum()&&L.getInstance().removeTalkingPoint(t.getTalkingPointId())}}class oe extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.model=this.owner.residentLogicScript.getModel()}getModel(){return this.model}onUseBuildingCondition(e){if(e==r.ResidentState.GotoTreat)return 2==this.getModel().getSick()&&(this.useBuildingAIPriority=1,!0);if(e==r.ResidentState.GotoToolBuilding)return!!this.getModel().isAdult()&&(1==this.getModel().getCollectionSpeedScale()&&this.getModel().getTeach()>=0);if(e==r.ResidentState.GotoVillageCom)return!!this.getModel().isAdult()&&(1==this.getModel().getFarmScale()&&this.getModel().getTeach()>=0);if(e==r.ResidentState.GotoBloodBuilding){let e=this.getModel().getLife();return!(e>=80)&&(e>=50?a.randomYes(.8):e>=30?a.randomYes(.3):e>=10?a.randomYes(.15):e>=0)}if(e==r.ResidentState.GoToSchool)return this.getModel().getTeach()<100;if(e==r.ResidentState.GotoChildSchoolForLearn)return!!a.randomYes()&&!this.getModel().isAdult();if(e==r.ResidentState.GotoFoodPoolForEat){let e=this.getModel().getFood();return e<90||e<50&&(this.useBuildingAIPriority=1,!0)}if(e==r.ResidentState.GotoWaterPoolForDrink){let e=this.getModel().getWater();return this.getModel().getWater()<90||e<50&&(this.useBuildingAIPriority=1,!0)}if(e==r.ResidentState.GotoFireForHeating){let e=this.getModel().getTemperature();return e<r.ResidentDangerTemperature+2?(this.useBuildingAIPriority=1,!0):e<r.ResidentStandardTemperature-1}return e==r.ResidentState.GotoSpeedBuildingForAddSpeed?!!this.getModel().isAdult()&&!(this.getModel().getSpeedScale()>1):e==r.ResidentState.GoToOfficeForWork?!!this.getModel().isAdult():e==r.ResidentState.GotoOperaForWatch?this.getModel().getEnjoy()<90:void 0}onFinishUseBuilding(e){if(e==r.ResidentState.Treating)this.getModel().setSick(1),this.owner.residentLogicScript.setBuffAniVisible(!1),this.owner.residentLogicScript.stopBuffAni();else if(e==r.ResidentState.UpdateFarmSpeed)this.getModel().setFarmScale(.1);else if(e==r.ResidentState.AddBlood)this.getModel().addLife(1);else if(e==r.ResidentState.UpdateTool)this.getModel().setCollectionSpeedScale(.1);else if(e==r.ResidentState.Learning){let e=this.useBuilding.buildingScript.getAddTeachInfo();console.debug(e),a.randomYes(e.addTeachPriority)&&(console.debug("成功教育"),this.getModel().addTeach(e.addTeach))}else if(e==r.ResidentState.ChildLearn){let e=this.useBuilding.buildingScript.getAddAgePriority();a.randomYes(e)&&this.getModel().addAgeExp(Math.round(r.ResidentAgePeriod/5),!0)}else if(e==r.ResidentState.EatFoodInFoodPool){let e=this.model.getFood(),t=this.useBuilding.buildingScript.getCurSaveFood(),i=Math.round(100-e),n=0;(n=i>=t?t:i)>40&&(n=40),this.useBuilding.buildingScript.addFoodToPool(-n),this.getModel().addFood(n)}else if(e==r.ResidentState.DrinkWaterInWaterPool){let e=this.getModel().getWater(),t=this.useBuilding.buildingScript.getCurSaveWater(),i=Math.round(100-e),n=0;(n=i>=t?t:i)>40&&(n=40),this.useBuilding.buildingScript.addWaterToPool(-n),this.getModel().addWater(n)}else if(e==r.ResidentState.Heating){this.getModel().setTemperature(r.ResidentStandardTemperature);let e=this.useBuilding.buildingScript;if(e.removeResidentIdToBuildingForUse(this.getModel().getResidentId()),e.getHeatingTimes()>=e.getHeatingMaxTimes()){0==e.getResidentIdToBuildingForUseNum()&&E.getInstance().removeBuildingById(e.getModel().getBuildingId())}}else if(e==r.ResidentState.AddSpeed){let e=s.BuildingDatas[s.BuildingType.SpeedBuildingType].addSpeedScale;this.getModel().setSpeedScale(e)}else if(e==r.ResidentState.Working){let e=s.BuildingDatas[s.BuildingType.OfficeType].addGold,t=this.useBuilding.buildingScript,i=Math.min(e,t.getCurSaveGold());t.addGoldToOffice(-i),L.getInstance().addGoldNum(i)}else if(e==r.ResidentState.WatchOpera){let e=this.useBuilding.buildingScript.getCurSaveEnjoy();this.getModel().addEnjoy(e),this.useBuilding.buildingScript.setEnjoyToOpera(0)}}onGetBuilding(e,t){if(e==r.ResidentState.GotoTreat){return E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,t.buildingType,2e3,[s.BuildingState.Noraml],null,!0)}if(e==r.ResidentState.GotoToolBuilding){return E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,t.buildingType,2e3,[s.BuildingState.Noraml],null,!0)}if(e==r.ResidentState.GotoVillageCom){return E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,t.buildingType,2e3,[s.BuildingState.Noraml],null,!0)}if(e==r.ResidentState.GoToSchool){return E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,t.buildingType,2e3,[s.BuildingState.Noraml],null,!0)}if(e==r.ResidentState.GotoChildSchoolForLearn){return E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,t.buildingType,2e3,[s.BuildingState.Noraml],null,!0)}if(e==r.ResidentState.GotoFoodPoolForEat){let e=function(e){return e.buildingScript.getCurSaveFood()>0};return E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,t.buildingType,2e3,[s.BuildingState.Noraml],e,!0)}if(e==r.ResidentState.GotoWaterPoolForDrink){let e=function(e){return e.buildingScript.getCurSaveWater()>0};return E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,t.buildingType,2e3,[s.BuildingState.Noraml],e,!0)}if(e==r.ResidentState.GotoFireForHeating){return E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,t.buildingType,2e3,[s.BuildingState.Noraml],function(e){return e.buildingScript.getHeatingTimes()<e.buildingScript.getHeatingMaxTimes()},!0)}if(e==r.ResidentState.GotoSpeedBuildingForAddSpeed){return E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,t.buildingType,2e3,[s.BuildingState.Noraml],null,!0)}if(e==r.ResidentState.GoToOfficeForWork){let e=function(e){return 0!=e.buildingScript.getCurSaveGold()&&!e.buildingScript.isReachGoldMax()};return E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,t.buildingType,2e3,[s.BuildingState.Noraml],e,!0)}if(e==r.ResidentState.GotoOperaForWatch){return E.getInstance().getAlltBuildingForCondition(this.owner.x,this.owner.y,t.buildingType,2e3,[s.BuildingState.Noraml],null,!0)}return null}onGotoUseBuildingPre(){this.useBuilding.buildingScript.getModel().getBuildingType()==s.BuildingType.FireType&&(this.useBuilding.buildingScript.addHeatingTimes(1),this.useBuilding.buildingScript.joinResidentIdToBuildingForUse(this.getModel().getResidentId()))}processUseBuildingAI(e,t){for(const i in r.ResidentUseBuildingMap){let n=r.ResidentUseBuildingMap[i];if(this.useBuildingAIPriority=2,this.onUseBuildingCondition(i)){let s={func:Laya.Handler.create(this,function(){let e=this.onGetBuilding(i,n);e&&(this.owner.residentLogicScript.refreshFSMState(i,e),this.owner.AILogicScript.ideaResult=!0)})};2==this.useBuildingAIPriority?t.push(s):e.push(s)}}}onUseBuildingPre(e){e.buildingType==s.BuildingType.FireType&&(this.owner.residentLogicScript.setAnim(r.ResidentAnim.Enjoy),this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani11"))}canGotoUseBuilding(e){return r.ResidentUseBuildingMap[String(e)]}startGotoBuildingForUse(e){let t=r.ResidentUseBuildingMap[this.getModel().getFSMState()];this.useBuilding=e.building;let i=e.nextState,n=this.useBuilding.x+this.useBuilding.width/2-this.owner.width/2,s=this.useBuilding.y+this.useBuilding.height-this.owner.height+r.ResidentGotoYOff;if(2==t.useType){s=this.useBuilding.y+this.useBuilding.height/2-this.owner.height+r.ResidentGotoYOff;let e=a.randomByArea3(n,s,70,100);n=e.x,s=e.y}this.onGotoUseBuildingPre(),this.owner.residentLogicScript.walkTo({x:n,y:s},Laya.Handler.create(this,function(){this.owner.residentLogicScript.refreshFSMState(i,this.useBuilding)}))}canStartUseBuilding(e){for(const t in r.ResidentUseBuildingMap){let i=r.ResidentUseBuildingMap[t];if(i.nextState==e&&null!=e&&null!=e)return i}return null}canFinishUseBuilding(e){for(const t in r.ResidentUseBuildingMap){if(r.ResidentUseBuildingMap[t].nextState==e&&null!=e&&null!=e)return!0}return!1}startUseBuilding(e){if(this.useBuilding){this.owner.residentLogicScript.stopAni(),2!=e.useType&&(this.owner.visible=!1);let t=this.useBuilding.buildingScript.getModel().getBuildingType(),i=s.BuildingDatas[String(t)];this.onUseBuildingPre(e),Laya.timer.once(i.useBuildingTime,this.owner.residentLogicScript,this.owner.residentLogicScript.onDoWorkFinish,[this.owner.residentLogicScript.makeParam(null)])}}clearUseBuilding(){Laya.timer.clear(this.owner.residentLogicScript,this.owner.residentLogicScript.onDoWorkFinish),this.useBuilding=null}}class re extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.model=this.owner.residentLogicScript.getModel()}getModel(){return this.model}processHunt(e,t){let i={func:Laya.Handler.create(this,function(e){let t=$.getInstance().getAnimalForAttack(this.owner.x,this.owner.y,2e3);t&&(this.owner.residentLogicScript.refreshFSMState(r.ResidentState.JoinHunt,t),this.owner.AILogicScript.ideaResult=!0)})};a.randomYes()&&this.getModel().isAdult()&&t.push(i)}startJoinHunt(e){this.hurtAnimal=e;let t=this.hurtAnimal.getComponent(Q);this.hurtAnimalId=t.getModel().getAnimalId(),S.getInstance().registEvent(m.HUNT_FINISH,this.owner.residentLogicScript,this.owner.residentLogicScript.onDoWorkFinish),t.joinHunt(this.getModel().getResidentId()),t.pauseWalk();let i=a.randomPointForX(this.hurtAnimal.x,this.hurtAnimal.y+this.hurtAnimal.height,this.hurtAnimal.width);this.owner.residentLogicScript.walkTo({x:i.x-this.owner.width/2,y:i.y-this.owner.height/2},Laya.Handler.create(this,function(){this.owner.residentLogicScript.refreshFSMState(r.ResidentState.Hunting)}))}onHunting(){if(this.hurtAnimal){this.hurtAnimal.getComponent(Q).setHurt(),this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani7"),this.owner.residentLogicScript.setAnim(r.ResidentAnim.Work)}}onHuntFinished(){this.hurtAnimal&&(S.getInstance().removeEvent(m.HUNT_FINISH,this.owner.residentLogicScript,this.owner.residentLogicScript.onDoWorkFinish),$.getInstance().removeAnimalById(this.hurtAnimalId),this.hurtAnimal=null,this.hurtAnimalId=null)}}class de extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.model=this.owner.residentLogicScript.getModel()}getModel(){return this.model}processFight(e,t){let i={func:Laya.Handler.create(this,function(){let e=this.owner.residentLogicScript.residentMgrInstance.getACanFightResident(this.getModel(),this.owner.x,this.owner.y);if(e){let t=L.getInstance().getOrCreateFightPoint(this.owner.x,this.owner.y,30,5);0==t.getFightNum()?(t.addFightNum(2),this.owner.residentLogicScript.refreshFSMState(r.ResidentState.JoinFight,t),e.residentLogicScript.refreshFSMState(r.ResidentState.JoinFight,t)):(t.addFightNum(1),this.owner.residentLogicScript.refreshFSMState(r.ResidentState.JoinFight,t)),this.owner.AILogicScript.ideaResult=!0}})};this.getModel().getSocial()<r.ResidentSocialLowToFight&&L.getInstance().getAllResidentNum()>=r.ResidentFightNum&&t.push(i)}startJoinFightPoint(e){let t=e.getFightPosInArea();this.owner.residentLogicScript.walkTo({x:t.x,y:t.y},Laya.Handler.create(this,function(){this.owner.residentLogicScript.refreshFSMState(r.ResidentState.Fighting,e)}))}onFight(e){this.owner.residentLogicScript.setAnim(r.ResidentAnim.Anger,null,a.randomYes()?"left":"right"),this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani8"),Laya.timer.once(10*r.SocialFightStep,this.owner.residentLogicScript,this.owner.residentLogicScript.onDoWorkFinish,[this.owner.residentLogicScript.makeParam(e)])}onFightFinished(e){let t=e.extraParam;t.addFightNum(-1),this.getModel().addLife(-r.ResidentFightReduceValue),0==t.getFightNum()&&L.getInstance().removeFightPoint(t.getFightPointId())}}class le extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onStart(){this.model=this.owner.residentLogicScript.getModel()}getModel(){return this.model}processLookForLover(e,t){if(a.randomYes(.2)&&this.getModel().canAskMarry()){let t=E.getInstance().getBuildingById(this.getModel().getMyHomeId());if(t){let i=t.buildingScript.getModel(),n=L.getInstance().getAllResidentNum(),a=L.getInstance().getHomeNum()*r.ResidentNumPerHome;if(i.getBuildingState()==s.BuildingState.Noraml&&n<=a){let t={func:Laya.Handler.create(this,function(){let e=this.owner.residentLogicScript.residentMgrInstance.getCanMarryWoman(this.getModel());if(e){let t=e.residentLogicScript,i=t.getModel();L.getInstance().setMarried(this.getModel(),i),this.owner.residentLogicScript.refreshFSMState(r.ResidentState.LoverMan),t.refreshFSMState(r.ResidentState.LoverWoman),this.owner.AILogicScript.ideaResult=!0}})};e.push(t)}}}}startGoHomeAndWoman(){let e=E.getInstance().getBuildingById(this.getModel().getMyHomeId());e?(this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani5"),this.owner.residentLogicScript.walkTo({x:e.x+e.width/2-this.owner.width/2,y:e.y+e.height-this.owner.height+r.ResidentGotoYOff,forceFirstY:!0},Laya.Handler.create(this,function(){this.owner.residentLogicScript.refreshFSMState(r.ResidentState.LoverMakeLove)}))):this.owner.residentLogicScript.refreshFSMState(r.ResidentState.IdleState)}startFindWoman(){let e=this.getModel().getLoverId(),t=this.owner.residentLogicScript.residentMgrInstance.getResidentById(e);t?(this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani5"),this.owner.residentLogicScript.walkTo({x:t.x+t.width,y:t.y},Laya.Handler.create(this,function(){this.owner.residentLogicScript.refreshFSMState(r.ResidentState.LoverGoHomeMakeLove),t.residentLogicScript.refreshFSMState(r.ResidentState.LoverGoHomeMakeLove)}))):this.owner.residentLogicScript.refreshFSMState(r.ResidentState.IdleState)}onWomanWaitMan(){this.owner.residentLogicScript.setAnim(r.ResidentAnim.Idle),this.owner.residentLogicScript.setStateAniVisible(!0),this.owner.residentLogicScript.setStateAni("ani5")}startMakelove(){if(this.owner.residentLogicScript.setVisible(!1),1==this.getModel().getSex()){E.getInstance().getBuildingById(this.getModel().getMyHomeId()).buildingScript.startMakeLove(Laya.Handler.create(this,function(){let e=this.getModel().getLoverId(),t=this.owner.residentLogicScript.residentMgrInstance.getResidentById(e);t.y+=r.ResidentGotoYOff,this.owner.y+=r.ResidentGotoYOff,t.residentLogicScript.refreshFSMState(r.ResidentState.IdleState),this.owner.residentLogicScript.refreshFSMState(r.ResidentState.IdleState),this.owner.residentLogicScript.residentMgrInstance.createResidentByConfig({parent:A.mapContainer,x:t.x,y:t.y,age:1,sex:L.getInstance().randomSex(),food:70,water:70})}))}this.getModel().recordMakeLoveSystemTime()}}class he extends Laya.Script{constructor(){super(),this.residents={}}onEnable(){}onDisable(){}static getInstance(){return he.instance?he.instance:(he.instance=new he,he.instance.initSelf(),he.instance)}initSelf(){Laya.timer.loop(r.ResidentMakeIdeaStep,this,this.onMakeIdea),Laya.timer.loop(100,this,this.onUpdateZorder)}onUpdateZorder(){for(let e in this.residents){let t=this.residents[e];t.residentLogicScript.pet&&M.setMapZOrder(t.residentLogicScript.pet),M.setMapZOrder(t)}}onMakeIdea(){for(let e in this.residents){let t=this.residents[e];M.setMapZOrder(t),t.AILogicScript.makeIdea()}}getResidentById(e){return this.residents[String(e)]}createResidentByConfig(t){let i=Laya.loader.getRes(e.ResidentPrefabPath).create();t.parent.addChild(i),this.initAllLogic(i);let n=L.getInstance().newResidentModel(t);return i.residentLogicScript.refreshByModel(n),i.residentLogicScript.setResidentMgrInstance(this),this.residents[String(n.getResidentId())]=i,i}initAllLogic(e){let t=e.getComponent(te);e.residentLogicScript=t;let i=e.getComponent(D);e.residentMoveLogicScript=i;let n=e.getComponent(N);e.AILogicScript=n;let s=e.getComponent(J);e.createBuildingScript=s;let a=e.getComponent(Z);e.sendScript=a;let o=e.getComponent(ie);e.doSomeThingScript=o;let r=e.getComponent(ne);e.randomWalkScript=r;let d=e.getComponent(se);e.findBlockForCreateScript=d;let l=e.getComponent(ae);e.socialScript=l;let h=e.getComponent(oe);e.useBuildingScript=h;let g=e.getComponent(re);e.huntScript=g;let c=e.getComponent(de);e.fightScript=c;let u=e.getComponent(le);e.lookForLoverScript=u}removeResidentById(e){let t=this.residents[String(e)];if(t){let i=t.residentLogicScript.getModel(),n=t.residentLogicScript.getPet();n&&n.destroy(!0);for(const t in this.residents){let n=this.residents[t].residentLogicScript.getModel();n.getLoverId()==e&&n.setLoverId(0),1==i.getSex()&&n.getMyHomeId()==i.getMyHomeId()&&n.setMyHomeId(0)}delete this.residents[String(e)],t.destroy(!0),L.getInstance().removeResientModel(e)}}getACanSocialResident(e){let t=e.x,i=e.y,n=[],s=[];for(const a in this.residents){let o=this.residents[a],d=o.residentLogicScript.getModel(),l=new Laya.Point(t,i).distance(o.x,o.y);e!=o&&l<=r.ResidentSocialArea&&d.getFSMState()==r.ResidentState.IdleState&&(n.push(o),d.getSocial()<r.ResidentSocialNeedValue&&s.push(o))}return 0!=s.length?s[0]:0!=n.length?n[0]:null}getACanFightResident(e,t,i){let n=[],s=[];for(const a in this.residents){let o=this.residents[a],d=o.residentLogicScript.getModel(),l=new Laya.Point(t,i).distance(o.x,o.y);e.getResidentId()!=d.getResidentId()&&l<=r.ResidentFightArea&&d.getFSMState()==r.ResidentState.IdleState&&(n.push(o),d.getSocial()<r.ResidentSocialLowToFight&&s.push(o))}return 0!=s.length?s[0]:0!=n.length?n[0]:null}getCanMarryWoman(e){for(const t in this.residents){let i=this.residents[t];if(i.residentLogicScript.getModel().canMarry(e))return i}return null}}class ge extends Laya.Script{constructor(){super()}onEnable(){this.ScrollView=this.owner.getChildByName("ScrollView"),this.container=this.ScrollView.getChildByName("container"),he.getInstance().createResidentByConfig({parent:this.container,x:this.container.width/2-300,y:this.container.height/2,sex:2,age:29}),he.getInstance().createResidentByConfig({parent:this.container,x:this.container.width/2-200,y:this.container.height/2,sex:1,age:28}),he.getInstance().createResidentByConfig({parent:this.container,x:this.container.width/2-200,y:this.container.height/2,sex:1,age:1})}onDisable(){}}class ce extends Laya.Script{constructor(){super()}onEnable(){M.setMapZOrder(this.owner,-A.mapHeight),this.curBg=this.owner.getChildByName("curBg"),this.toBg=this.owner.getChildByName("toBg"),this.curSeason=L.getInstance().getGameSeason(),this.switchSeason(this.curSeason,!0),Laya.timer.loop(1e3,this,this.onTimeTick)}onDisable(){Laya.timer.clear(this,this.onTimeTick)}onTimeTick(){this.curSeason!=L.getInstance().getGameSeason()&&(this.curSeason=L.getInstance().getGameSeason(),this.switchSeason(this.curSeason))}switchSeason(e,t){this.tweenObject&&(Laya.Tween.clear(this.tweenObject),this.tweenObject=null);let i=o.Seasons[e];if(t)this.toBg.visible=!1,this.curBg.bgColor=i;else{this.toBg.visible=!0,this.toBg.bgColor=this.curBg.bgColor,this.curBg.bgColor=i,this.toBg.alpha=1,this.curBg.alpha=0;let e=4e3;this.tweenObject=Laya.Tween.to(this.curBg,{alpha:1},e,null,Laya.Handler.create(this,function(){this.tweenObject&&(Laya.Tween.clear(this.tweenObject),this.tweenObject=null),this.toBg.visible=!1}))}}}class ue extends Laya.Script{constructor(){super()}onEnable(){this.startPos=null,this.container=this.owner.getChildByName("container"),A.mapContainer=this.container,A.mapWidth=this.container.width,A.mapHeight=this.container.height}onDisable(){}onStart(){for(let e=0;e<this.container.numChildren;e++){let t=this.container.getChildAt(e);t.getComponent(V)&&Y.getInstance().pushTree(t),t.getComponent(j)&&U.getInstance().pushStone(t),t.getComponent(_)&&X.getInstance().pushWater(t),t.getComponent(G)&&O.getInstance().pushFoodTrigger(t)}this.lookAt(A.mapWidth/2,A.mapHeight/2)}onMouseDown(e){this.startPos={x:e.stageX,y:e.stageY}}onMouseMove(e){if(this.startPos){let t=e.stageX-this.startPos.x,i=e.stageY-this.startPos.y;this.processMapPos(this.container.x+t,this.container.y+i),this.startPos.x=e.stageX,this.startPos.y=e.stageY}}onMouseUp(e){this.startPos=null}onMouseOut(e){this.startPos=null}processMapPos(e,t){let i=this.getMapPos(e,t);this.container.x=i.x,this.container.y=i.y}getMapPos(e,t){return e>-o.MapSideOff&&(e=-o.MapSideOff),t>-o.MapSideOff&&(t=-o.MapSideOff),e<this.owner.width-A.mapWidth+o.MapSideOff&&(e=this.owner.width-A.mapWidth+o.MapSideOff),t<this.owner.height-A.mapHeight+o.MapSideOff&&(t=this.owner.height-A.mapHeight+o.MapSideOff),{x:e,y:t}}lookAt(e,t,i){null!=i&&null!=i||(i=!1),this.tweenObject&&(Laya.Tween.clear(this.tweenObject),this.tweenObject=null);let n=new Laya.Point(e,t);this.container.localToGlobal(n);let s=Laya.stage.width/2,a=Laya.stage.height/2,o=s-n.x,r=a-n.y,d=this.container.x+o,l=this.container.y+r;if(i){let e=this.getMapPos(d,l);this.tweenObject=Laya.Tween.to(this.container,{x:e.x,y:e.y},1e3,Laya.Ease.sineOut,Laya.Handler.create(this,function(){this.tweenObject&&(Laya.Tween.clear(this.tweenObject),this.tweenObject=null)}))}else this.processMapPos(d,l)}}class Se extends Laya.Script{constructor(){super()}onEnable(){this.treeLabel=this.owner.getChildByName("tree"),this.stoneLabel=this.owner.getChildByName("stone"),this.goldLabel=this.owner.getChildByName("gold"),this.timeLabel=this.owner.getChildByName("time"),this.elecLabel=this.owner.getChildByName("elec"),this.seasonTextTable=["春","夏","秋","冬"],this.refreshLabel(),Laya.timer.loop(o.GameTimeStep,this,this.onTick)}onDisable(){Laya.timer.clear(this,this.onTick)}refreshLabel(){this.treeLabel.text=String(L.getInstance().getTreeNum()),this.stoneLabel.text=String(L.getInstance().getStoneNum()),this.goldLabel.text=String(L.getInstance().getGoldNum()),this.elecLabel.text=String(L.getInstance().getElecNum());let e=L.getInstance().getAllResidentNum(),t=L.getInstance().getGameSeason(),i=L.getInstance().getGameDay(),n=L.getInstance().getGameHour();this.timeLabel.text=String(this.seasonTextTable[t])+"  "+String(i.zeroPad(10))+"日"+String(n.zeroPad(10))+"时, 人口: "+String(e)}onTick(){this.refreshLabel()}}class pe extends Laya.Script{constructor(){super()}onEnable(){this.switchState=0,this.initBg(),this.initTOuchLayer(),this.setTouchLayerEnabled(!1),this.initItems(),this.initScrollTouch(),Laya.timer.loop(300,this,this.refreshCondition),this.refreshCondition()}onDisable(){Laya.timer.clear(this,this.refreshCondition)}refreshCondition(){for(const e in this.items){let t=this.items[e],i=t.showData,n=L.getInstance().getTreeNum(),s=L.getInstance().getStoneNum(),a=!1;t.treeNeed.color="#1497ef",t.stoneNeed.color="#1497ef",n<i.costTree&&(a=!0,t.treeNeed.color="#ef1437"),s<i.costStone&&(a=!0,t.stoneNeed.color="#ef1437"),t.lock.visible=a}}initItems(){this.dataArray=[],this.items={};for(const e in s.BuildingDatas){let t=s.BuildingDatas[e];t.preview&&""!=t.preview&&this.dataArray.push(t)}this.clip=this.under.getChildByName("clip"),this.content=this.clip.getChildByName("content");this.dragRender=Laya.loader.getRes(e.DragRenderPrefabPath).create();let t=Laya.loader.getRes(e.CommonItemPrefabPath),i=0;for(let e=0;e<this.dataArray.length;e++){let n=this.dataArray[e],s=t.create();0==e&&(i=s.height),s.getChildByName("spr").loadImage(n.preview),s.getChildByName("textName").text="["+n.buildingName+"]";let a=s.getChildByName("treeNeed");a.text="木材:"+String(n.costTree);let o=s.getChildByName("stoneNeed");o.text="石材:"+String(n.costStone),s.getChildByName("desc").text=n.desc;let r=s.getChildByName("lock");s.lock=r,s.treeNeed=a,s.stoneNeed=o,this.content.addChild(s),s.y=e*i+5*(e+1),s.showIndex=e,s.showData=n,this.items[String(e)]=s}this.content.height=i*this.dataArray.length+5*this.dataArray.length}getItem(e,t){for(const i in this.items){let n=this.items[i];if(n.hitTestPoint(e,t))return n}return null}initScrollTouch(){this.touchScroll=this.clip.getChildByName("touchScroll"),this.touchDownPoint=null,this.touchScroll.on(Laya.Event.MOUSE_DOWN,this,function(e){this.dragItem=null,this.touchDownStartPoint=new Laya.Point(e.stageX,e.stageY),this.touchDownPoint=new Laya.Point(e.stageX,e.stageY);let t=this.getItem(e.stageX,e.stageY);t&&Laya.timer.once(200,this,this.onDragStart,[t])}),this.touchScroll.on(Laya.Event.MOUSE_MOVE,this,function(e){if(this.touchDownPoint&&(null==this.dragItem||null==this.dragItem)){Math.abs(this.touchDownStartPoint.y-e.stageY)>=5&&Laya.timer.clear(this,this.onDragStart);let t=e.stageY-this.touchDownPoint.y;this.content.y=this.content.y+t;let i=this.clip.height-this.content.height;this.content.y<i?this.content.y=i:this.content.y>0&&(this.content.y=0),this.touchDownPoint.setTo(e.stageX,e.stageY)}}),this.touchScroll.on(Laya.Event.MOUSE_OUT,this,function(e){this.touchDownPoint=null,Laya.timer.clear(this,this.onDragStart),this.touchDownStartPoint=null}),this.touchScroll.on(Laya.Event.MOUSE_UP,this,function(e){this.touchDownPoint=null,this.touchDownStartPoint=null,Laya.timer.clear(this,this.onDragStart)})}onDragStart(t){if(Laya.timer.clear(this,this.onDragStart),t.lock.visible)n.getInstance().showTip("建造条件不足");else if(this.dragItem=t,this.setTouchLayerEnabled(!0),this.dragItem){let t=this.dragItem.showData;this.dragRender&&(this.dragRender.destroy(!0),this.dragRender=null);let i=Laya.loader.getRes(e.DragRenderPrefabPath);this.dragRender=i.create(),this.dragRender.width=t.width,this.dragRender.height=t.height,this.dragRender.dragMask=this.dragRender.getChildByName("dragMask"),this.dragRender.dragMask.width=t.width,this.dragRender.dragMask.height=t.height,this.dragRender.dragMask2=this.dragRender.getChildByName("dragMask2"),this.dragRender.dragMask2.width=t.width,this.dragRender.dragMask2.height=t.height,this.setBuildingCreateEnabled(!0),this.touchLayer.addChild(this.dragRender);let n=new Laya.Sprite;n.loadImage(t.preview),this.dragRender.addChild(n),n.pos(t.adjustX,t.adjustY);let s=new Laya.Point(Laya.stage.mouseX,Laya.stage.mouseY);this.touchLayer.globalToLocal(s);let a=s.x-this.dragRender.width/2,o=s.y-this.dragRender.height/2;this.dragRender.pos(a,o),this.under.visible=!1}}initTOuchLayer(){this.touchLayer=this.owner.getChildByName("touch"),this.touchLayerOriWidth=this.touchLayer.width}onTouchLayerMouseMove(e){if(this.dragRender){let t=new Laya.Point(e.stageX,e.stageY);this.touchLayer.globalToLocal(t);let i=t.x-this.dragRender.width/2,n=t.y-this.dragRender.height/2;this.dragRender.pos(i,n),A.mapContainer&&(t=new Laya.Point(e.stageX,e.stageY),A.mapContainer.globalToLocal(t),i=t.x-this.dragRender.width/2,n=t.y-this.dragRender.height/2,K.isOccupySpace(i,n,this.dragRender.width,this.dragRender.height)?this.setBuildingCreateEnabled(!1):this.setBuildingCreateEnabled(!0))}}onTouchLayerMouseUp(e){if(A.mapContainer){let t=new Laya.Point(e.stageX,e.stageY);A.mapContainer.globalToLocal(t);let i=t.x-this.dragRender.width/2,s=t.y-this.dragRender.height/2,a=this.dragItem.showData;K.isOccupySpace(i,s,this.dragRender.width,this.dragRender.height)?n.getInstance().showTip("不可放置~"):this.onBuild(a,i,s)}this.dragItem&&(this.dragItem=null),this.dragRender&&this.dragRender.destroy(!0),this.setTouchLayerEnabled(!1),this.under.visible=!0}onTouchLayerMouseOut(e){this.dragItem&&(this.dragItem=null),this.dragRender&&this.dragRender.destroy(!0),this.setTouchLayerEnabled(!1),this.under.visible=!0}setTouchLayerEnabled(e){e?(this.touchLayer.width=this.touchLayerOriWidth,this.touchLayer.on(Laya.Event.MOUSE_MOVE,this,this.onTouchLayerMouseMove),this.touchLayer.on(Laya.Event.MOUSE_UP,this,this.onTouchLayerMouseUp),this.touchLayer.on(Laya.Event.MOUSE_OUT,this,this.onTouchLayerMouseOut)):(this.touchLayer.width=0,this.touchLayer.off(Laya.Event.MOUSE_MOVE,this,this.onTouchLayerMouseMove),this.touchLayer.off(Laya.Event.MOUSE_UP,this,this.onTouchLayerMouseUp),this.touchLayer.off(Laya.Event.MOUSE_OUT,this,this.onTouchLayerMouseOut))}setBuildingCreateEnabled(e){this.dragRender&&(this.dragRender.dragMask.visible=e,this.dragRender.dragMask2.visible=!e)}setUnderState(e){this.switchState!=e&&(this.switchState=e,0==this.switchState?(Laya.Tween.to(this.under,{x:-this.under.width},200,Laya.Ease.backOut),this.switchBtn.scaleY=1):(Laya.Tween.to(this.under,{x:0},200,Laya.Ease.backIn),this.switchBtn.scaleY=-1))}initBg(){this.under=this.owner.getChildByName("under"),this.under.x=-this.under.width,this.oriOwerWidth=this.owner.width,this.owner.width=0,this.switchBtn=this.under.getChildByName("btn"),this.switchBtn.on(Laya.Event.CLICK,this,function(){1==this.switchState?(this.setUnderState(0),this.owner.width=0):(this.setUnderState(1),this.owner.width=this.oriOwerWidth)})}onBuild(e,t,i){L.getInstance().addTreeNum(-s.BuildingDatas[String(e.type)].costTree),L.getInstance().addStoneNum(-s.BuildingDatas[String(e.type)].costStone);E.getInstance().createBuildingByConfig({parent:A.mapContainer,x:Math.round(t),y:Math.round(i),width:e.width,height:e.height,prefab:e.prefab,buildingType:e.type})}}class me extends Laya.Script{constructor(){super()}onEnable(){this.curNum=0}onDisable(){}onStart(){this.owner.timer.loop(d.AnimalUpdateTime,this,function(){if(this.curNum>=d.AnimalMaxNumPerTrigger)return;let e=a.randomByArea(this.owner.x,this.owner.y,d.AnimalTriggerArea);$.getInstance().createAnimalByConfig({parent:A.mapContainer,x:e.x,y:e.y,trigger:this}),this.addNum(1)})}addNum(e){this.curNum=this.curNum+e,this.curNum>=d.AnimalMaxNumPerTrigger&&(this.curNum=d.AnimalMaxNumPerTrigger)}}class ye extends k{constructor(){super()}onInitBuilding(){}onCreateBuildingFinish(){}}class fe extends k{constructor(){super()}onInitBuilding(){}onCreateBuildingFinish(){}getChildTeacherIndex(){let e=this.getModel().getExteraData("curTeacherIndex");return null!=e&&null!=e||(e=0),Number(e)}setChildTeacherIndex(e){this.getModel().setExteraData("curTeacherIndex",e)}getAddAgePriority(){let e=this.getChildTeacherIndex();return-1==e?0:s.BuildingDatas[String(s.BuildingType.ChildSchoolType)].teachers[e].addAgePriority}onClickBuilding(){Laya.Dialog.open(e.ChildSchoolDialogScenePath,null,null,Laya.Handler.create(this,function(e){e.selectedBuilding=this.owner}))}}class Te extends k{constructor(){super()}onEnable(){super.onEnable(),this.foodPoolText=this.owner.getChildByName("foodPoolText"),this.foodPoolText.visible=!1,this.maxSave=s.BuildingDatas[s.BuildingType.FoodPoolType].maxSave}onDisable(){Laya.timer.loop(this,this.onAddFood),super.onDisable()}onClickBuilding(){Laya.Dialog.open(e.FarmLandDialogScenePath,null,null,Laya.Handler.create(this,function(e){e.selectedBuilding=this.owner}))}onAddFood(){let e=L.getInstance().getGameSeason();1!=e&&2!=e||this.addFoodToPool(1)}getCurSaveFood(){let e=this.getModel().getExteraData("curFood");return null!=e&&null!=e||(e=0),e}isReachFoodMax(){return this.getCurSaveFood()>=this.maxSave}addFoodToPool(e){let t=this.getModel(),i=this.getCurSaveFood();(i+=e)<0&&(i=0),i>this.maxSave&&(i=this.maxSave),t.setExteraData("curFood",i),this.foodPoolText.text=String(i)+"/"+String(this.maxSave)}onInitBuilding(){this.addFoodToPool(0)}onCreateBuildingFinish(){this.foodPoolText.visible=!0,Laya.timer.loop(1e3,this,this.onAddFood);for(let e=0;e<3;e++)this.addAnimal()}addAnimal(){let t=Laya.loader.getRes(e.Livestock3PrefabPath).create();this.owner.addChild(t),t.moveScript=t.getComponent(D),t.ani=t.getChildByName("ani");let i=t;t.moveScript.setCallbackFunc({leftFunc:function(){i.ani.play(0,!0,"walk_left")},rightFunc:function(){i.ani.play(0,!0,"walk_right")},upFunc:function(){i.ani.play(0,!0,"walk_up")},downFunc:function(){i.ani.play(0,!0,"walk_down")}});let n=this.owner.width/2,s=this.owner.height/2;t.x=n,t.y=s,this.startWalk(t)}startWalk(e){let t=a.randomPointInRect(0,0,this.owner.width-e.width,this.owner.height-e.height);e.moveScript.gotoDest({x:t.x,y:t.y,speed:2},Laya.Handler.create(this,function(){this.startWalk(e)}))}}class Le extends k{constructor(){super()}onInitBuilding(){}getHeatingTimes(){let e=this.getModel().getExteraData("curHeatingTimes");return null!=e&&null!=e||(e=0),e}getHeatingMaxTimes(){return s.BuildingDatas[this.model.getBuildingType()].heatingMaxTImes}setHeatingTimes(e){let t=this.getHeatingMaxTimes();e>t&&(e=t),this.getModel().setExteraData("curHeatingTimes",e)}addHeatingTimes(e){this.setHeatingTimes(this.getHeatingTimes()+e)}onCreateBuildingFinish(){M.setMapZOrder(this.owner,null,-50)}}class we extends k{constructor(){super()}onEnable(){super.onEnable(),this.foodPoolText=this.owner.getChildByName("foodPoolText"),this.foodPoolText.visible=!1,this.maxSave=s.BuildingDatas[s.BuildingType.FoodPoolType].maxSave}getCurSaveFood(){let e=this.getModel().getExteraData("curFood");return null!=e&&null!=e||(e=0),e}addFoodToPool(e){let t=this.getModel(),i=this.getCurSaveFood();(i+=e)<0&&(i=0),i>this.maxSave&&(i=this.maxSave),t.setExteraData("curFood",i),this.foodPoolText.text=String(i)+"/"+String(this.maxSave)}isReachFoodMax(){return this.getCurSaveFood()>=this.maxSave}onInitBuilding(){this.addFoodToPool(0)}onCreateBuildingFinish(){this.foodPoolText.visible=!0}}class Be extends k{constructor(){super()}onInitBuilding(){}onCreateBuildingFinish(){}onDisable(){Laya.timer.clear(this,this.onMakeLove),Laya.timer.clear(this,this.onCreateProgress)}startMakeLove(e){this.makeLoveHandler=e,this.ani.play(0,!0,"makelove"),Laya.timer.once(5e3,this,this.onMakeLove)}onMakeLove(){this.makeLoveHandler&&(this.makeLoveHandler.run(),this.makeLoveHandler=null,this.ani.play(0,!0,"idle"),Laya.timer.clear(this,this.onMakeLove))}}class be extends k{constructor(){super()}onInitBuilding(){}onCreateBuildingFinish(){}onClickBuilding(){Laya.Dialog.open(e.HospitalDialogScenePath,null,null,Laya.Handler.create(this,function(e){e.selectedBuilding=this.owner}))}}class Fe extends k{constructor(){super()}onInitBuilding(){}onCreateBuildingFinish(){}onClickBuilding(){Laya.Dialog.open(e.LabDialogScenePath,null,null,Laya.Handler.create(this,function(e){e.selectedBuilding=this.owner}))}}class xe extends k{constructor(){super()}onEnable(){super.onEnable(),this.officeGoldText=this.owner.getChildByName("officeGoldText"),this.officeGoldText.visible=!1,this.maxSave=s.BuildingDatas[s.BuildingType.OfficeType].maxSave}getCurSaveGold(){let e=this.getModel().getExteraData("curGold");return null!=e&&null!=e||(e=0),e}setCurSaveGold(e){e<0&&(e=0),e>this.maxSave&&(e=this.maxSave),this.getModel().setExteraData("curGold",e),this.officeGoldText.text=String(e)+"/"+String(this.maxSave)}addGoldToOffice(e){let t=this.getCurSaveGold();t+=e,this.setCurSaveGold(t)}isReachGoldMax(){return this.getCurSaveGold()>=this.maxSave}onInitBuilding(){this.addGoldToOffice(0)}onCreateBuildingFinish(){this.officeGoldText.visible=!0}onClickBuilding(){Laya.Dialog.open(e.OfficeDialogScenePath,null,null,Laya.Handler.create(this,function(e){e.selectedBuilding=this.owner}))}}class Ce extends k{constructor(){super()}onEnable(){super.onEnable(),this.enjoyPoolText=this.owner.getChildByName("enjoytext"),this.enjoyPoolText.visible=!1}onInitBuilding(){}onCreateBuildingFinish(){this.enjoyPoolText.visible=!0,this.addEnjoyToOpera(0)}onClickBuilding(){Laya.Dialog.open(e.OperaDialogScenePath,null,null,Laya.Handler.create(this,function(e){e.selectedBuilding=this.owner}))}getCurSaveEnjoy(){let e=this.getModel().getExteraData("curEnjoy");return null!=e&&null!=e||(e=0),e}setEnjoyToOpera(e){this.getModel().setExteraData("curEnjoy",e),this.enjoyPoolText.text="储存快乐值: "+String(e)}addEnjoyToOpera(e){let t=this.getCurSaveEnjoy();(t+=e)<0&&(t=0),this.setEnjoyToOpera(t)}}class Ie extends k{constructor(){super()}onEnable(){super.onEnable(),this.foodPoolText=this.owner.getChildByName("foodPoolText"),this.foodPoolText.visible=!1,this.maxSave=s.BuildingDatas[s.BuildingType.PastureType].maxSave}onDisable(){Laya.timer.loop(this,this.onAddFood),super.onDisable()}onClickBuilding(){Laya.Dialog.open(e.PastureDialogScenePath,null,null,Laya.Handler.create(this,function(e){e.selectedBuilding=this.owner}))}onAddFood(){let e=L.getInstance().getGameSeason();0!=e&&3!=e||this.addFoodToPool(1)}getCurSaveFood(){let e=this.getModel().getExteraData("curFood");return null!=e&&null!=e||(e=0),e}isReachFoodMax(){return this.getCurSaveFood()>=this.maxSave}addFoodToPool(e){let t=this.getModel(),i=this.getCurSaveFood();(i+=e)<0&&(i=0),i>this.maxSave&&(i=this.maxSave),t.setExteraData("curFood",i),this.foodPoolText.text=String(i)+"/"+String(this.maxSave)}onInitBuilding(){this.addFoodToPool(0)}onCreateBuildingFinish(){this.foodPoolText.visible=!0,Laya.timer.loop(1e3,this,this.onAddFood),this.owner.zOrder=2;for(let e=0;e<2;e++)this.addAnimal(1);for(let e=0;e<2;e++)this.addAnimal(2)}addAnimal(t){let i=null;1==t?i=Laya.loader.getRes(e.Livestock1PrefabPath):2==t&&(i=Laya.loader.getRes(e.Livestock2PrefabPath));let n=i.create();this.owner.addChild(n),n.moveScript=n.getComponent(D),n.ani=n.getChildByName("ani");let s=n;n.moveScript.setCallbackFunc({leftFunc:function(){s.ani.play(0,!0,"walk_left")},rightFunc:function(){s.ani.play(0,!0,"walk_right")},upFunc:function(){s.ani.play(0,!0,"walk_up")},downFunc:function(){s.ani.play(0,!0,"walk_down")}});let a=this.owner.width/2,o=this.owner.height/2;n.x=a,n.y=o,this.startWalk(n)}startWalk(e){let t=a.randomPointInRect(0,0,this.owner.width-e.width,this.owner.height-e.height);e.moveScript.gotoDest({x:t.x,y:t.y,speed:2},Laya.Handler.create(this,function(){this.startWalk(e)}))}}class Re extends k{constructor(){super()}onInitBuilding(){}onCreateBuildingFinish(){}getTeacherIndex(){let e=this.getModel().getExteraData("curTeacherIndex");return null!=e&&null!=e||(e=0),Number(e)}getAddTeachInfo(){let e=this.getTeacherIndex();if(-1==e)return 0;let t=s.BuildingDatas[String(s.BuildingType.SchoolType)].teachers[e];return{addTeach:t.addTeach,addTeachPriority:t.addTeachPriority}}setTeacherIndex(e){this.getModel().setExteraData("curTeacherIndex",e)}onClickBuilding(){Laya.Dialog.open(e.SchoolDialogScenePath,null,null,Laya.Handler.create(this,function(e){e.selectedBuilding=this.owner}))}}class Pe extends k{constructor(){super()}onInitBuilding(){}onCreateBuildingFinish(){}}class Ae extends k{constructor(){super()}onInitBuilding(){}onCreateBuildingFinish(){}}class Me extends k{constructor(){super()}onInitBuilding(){}onCreateBuildingFinish(){}}class De extends k{constructor(){super()}onEnable(){super.onEnable(),this.waterPoolText=this.owner.getChildByName("waterPoolText"),this.waterPoolText.visible=!1,this.maxSave=s.BuildingDatas[s.BuildingType.WaterPoolType].maxSave}getCurSaveWater(){let e=this.getModel().getExteraData("curWater");return null!=e&&null!=e||(e=0),e}isReachWaterMax(){return this.getCurSaveWater()>=this.maxSave}addWaterToPool(e){let t=this.getModel(),i=this.getCurSaveWater();(i+=e)<0&&(i=0),i>this.maxSave&&(i=this.maxSave),t.setExteraData("curWater",i),this.waterPoolText.text=String(i)+"/"+String(this.maxSave)}onInitBuilding(){this.addWaterToPool(0)}onCreateBuildingFinish(){this.waterPoolText.visible=!0}}class ve{static init(){let e=Laya.ClassUtils.regClass;e("scene/ChildSchoolDialogLogic.js",w),e("scene/FarmLandDialogLogic.js",B),e("scene/HospitalDialogLogic.js",b),e("scene/LabDialogLogic.js",F),e("scene/OfficeDialogLogic.js",C),e("scene/OperaDialogLogic.js",I),e("scene/PastureDialogLogic.js",R),e("scene/SchoolDialogLogic.js",P),e("scene/TestSceneLogic.js",ge),e("game/SeasonLogic.js",ce),e("source/Treelogic.js",V),e("source/StoneLogic.js",j),e("source/FoodTrigger.js",G),e("source/Waterlogic.js",_),e("helper/MapScrollView.js",ue),e("panel/ResourcePanel.js",Se),e("panel/CommandPanel.js",pe),e("animal/AnimalLogic.js",Q),e("animal/AnimalTrigger.js",me),e("building/BloodBuildingLogic.js",ye),e("building/ChildSchoolLogic.js",fe),e("building/FarmLandLogic.js",Te),e("building/FireLogic.js",Le),e("source/FoodLogic.js",W),e("building/FoodPoolLogic.js",we),e("building/HomeLogic.js",Be),e("building/HospitalLogic.js",be),e("building/LabLogic.js",Fe),e("helper/MoveLogic.js",D),e("building/OfficeLogic.js",xe),e("building/OperaLogic.js",Ce),e("building/PastureLogic.js",Ie),e("animal/PetLogic.js",ee),e("resident/ResidentLogic.js",te),e("resident/ResidentAILogic.js",N),e("resident/ResidentCreateBuildingAILogic.js",J),e("resident/ResidentSendAILogic.js",Z),e("resident/ResidentDoSomeThingAILogic.js",ie),e("resident/ResidentRandomWalkAILogic.js",ne),e("resident/ResidentFindBlockForCreateAILogic.js",se),e("resident/ResidentSocialAILogic.js",ae),e("resident/ResidentUseBuildingAILogic.js",oe),e("resident/ResidentHuntAILogic.js",re),e("resident/ResidentFightAILogic.js",de),e("resident/ResidentLookForLoverAILogic.js",le),e("panel/ResidentDetailsPanel.js",z),e("building/SchoolLogic.js",Re),e("building/SpeedBuildingLogic.js",Pe),e("helper/TipLogic.js",i),e("building/ToolBuildingLogic.js",Ae),e("building/VillageComLogic.js",Me),e("building/WaterPoolLogic.js",De)}}ve.width=1336,ve.height=750,ve.scaleMode="fixedwidth",ve.screenMode="none",ve.alignV="top",ve.alignH="left",ve.startScene="scene/TestScene.scene",ve.sceneRoot="",ve.debug=!1,ve.stat=!1,ve.physicsDebug=!1,ve.exportSceneToJson=!0,ve.init();new class{constructor(){window.Laya3D?Laya3D.init(ve.width,ve.height):Laya.init(ve.width,ve.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=ve.scaleMode,Laya.stage.screenMode=ve.screenMode,Laya.stage.alignV=ve.alignV,Laya.stage.alignH=ve.alignH,Laya.stage.frameRate="slow",Laya.URL.exportSceneToJson=ve.exportSceneToJson,(ve.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),ve.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),ve.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){L.getInstance(),t.getInstance().loadAllRes(Laya.Handler.create(this,function(){this.initBuildDatas(),ve.startScene&&Laya.Scene.open(ve.startScene)}))}initBuildDatas(){for(const e in s.BuildingDatas){let i=s.BuildingDatas[e],n=t.getInstance().getPrefabInfo(i.prefab);i.width=n.json.props.width,i.height=n.json.props.height,i.adjustX=(i.width-i.realWidth)/2,i.adjustY=i.height-i.realHeight,i.type=e}}}}();